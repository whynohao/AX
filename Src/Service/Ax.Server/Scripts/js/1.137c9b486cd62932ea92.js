webpackJsonp([1,12,13],{145:function(e,t,n){n(622);var o=n(226)(n(648),n(603),"data-v-49f23532",null);e.exports=o.exports},227:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ConsoleItems",function(){return a}),n.d(t,"ConsoleItemKey",function(){return o});var o={OA_HOME:"OA_HOME",MESSAGES:"MESSAGES",SUPPLATFORM:"SUPPLATFORM",PUBLISH:"PUBLISH"},a=[{PROGID:o.OA_HOME,MENUITEM:"OA首页",enabled:!1,index:0},{PROGID:o.MESSAGES,MENUITEM:"我的消息",enabled:!0,index:1},{PROGID:o.SUPPLATFORM,MENUITEM:"供应商平台",enabled:!1,index:2},{PROGID:o.PUBLISH,MENUITEM:"新功能发布",enabled:!0,index:3}]},228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"EnumNavHeader",function(){return u}),n.d(t,"NavHeaderItems",function(){return f}),n.d(t,"NavHeaderItemUtility",function(){return h});var o=n(154),a=n.n(o),r=n(152),i=n.n(r),l=n(26),d=n.n(l),s=n(19),c=n.n(s),u=function e(){c()(this,e)};u.workbench="workbench",u.business="business",u.report="report",u.kpi="kpi",u.board="board",u.document="document",u.menuConfig="menuConfig",u.cpsModel="cpsModel";var p={key:u.workbench,text:"工作台",contrainer:"workbench",enabled:!0},f=[p,{key:u.business,text:"业务功能",contrainer:u.business,enabled:!0},{key:u.report,text:"报表管理",contrainer:u.business,enabled:!0},{key:u.kpi,text:"KPI管理",contrainer:u.business,enabled:!0},{key:u.board,text:"看板管理",contrainer:u.business,enabled:!1},{key:u.document,text:"文档管理",contrainer:u.document,enabled:!0},{key:u.cpsModel,text:"CPS建模",contrainer:"cpsModel",enabled:!0},{key:u.menuConfig,text:"功能菜单",contrainer:u.menuConfig,enabled:!0}],h=function(){function e(){c()(this,e)}return d()(e,null,[{key:"getDefaultHeaderItem",value:function(){return p}},{key:"getContrainers",value:function(){return i()(new a.a(f.map(function(e){return e.contrainer})))}}]),e}()},558:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return d});var o=n(26),a=n.n(o),r=n(19),i=n.n(r),l=n(561),d=function e(){i()(this,e)};d.mainPanelId="#cpsMainPanel",d.canvasId="#cpsCanvas",d.controlsId="#controlModule",d.cpsControlsId="#cpsControls",d.sysControlsId="#sysControls",d.drawSVGId="#drawSVGView",d.comTechRouteType="comTechRouteType_",d.comMaterial="comMaterial_",d.comWorkshopSection="comWorkshopSection_",d.comWorkProcess="comWorkProcess_",d.comWorkstationConfig="comWorkstationConfig_",d.comMaterialType="comMaterialType_",d.comTechRoute="comTechRoute_",d.comProduceLine="comProduceLine_",d.comWorkstation="comWorkstation_",d.materialTypeSize=50,d.materialSize=50,d.workstationConfigSize=50,d.workProcessSize=60,d.techRouteTypeSize=50,d.workshopSectionSize=60;var s=function e(){i()(this,e)};s.renderTo=null,s.controlLineModels=null,s.drawSvgWidth=0,s.drawSvgHeight=0,s.attrFormPanels=null,s.controlsAttrPanel=null,s.polylineAttrPanel=null,s.munePanel=null,s.descToolTip=null,s.masterVcl=null,s.useToolTip=!1,s.useVectorLine=!1,s.redrawVectorLine=!1,s.vectorLineIndex=1,s.positionRectPoints=null,s.redrawCpsControl=!1,s.cpsControlPoint=null,s.selControlId=null,s.selVectorLineId=null,s.selCpsControl=null,s.selSvgPolyline=null,s.isSelCpsControl=!0;var c=function(){function e(){i()(this,e)}return a()(e,null,[{key:"getProduceControlLineList",value:function(e,t){Ext.Ajax.request({url:"/CpsModule/GetProduceControlLineModel",jsonData:{produceControlLineId:e},method:"POST",async:!0,timeout:9e7,success:function(e){var n=Ext.JSON.decode(e.responseText);s.controlLineModels=n,t(n)},failure:function(e){Ext.Msg.alert("提示","获取CPS产线模型数据出现异常"),t(null),$("#cpsLoading").css("display","none")}})}},{key:"getCpsControlConfigureList",value:function(e,t,n){Ext.Ajax.request({url:"/CpsModule/GetCurrentConfig",jsonData:{controlConfigId:e,factoryModuleType:t},method:"POST",async:!0,timeout:9e7,success:function(e){var t=Ext.JSON.decode(e.responseText);s.controlLineModels.ControlConfigId=t.ControlConfigId,s.controlLineModels.FactoryModuleType=t.FactoryModuleType,n(t)},failure:function(e){Ext.Msg.alert("提示","获取当前CPS组件配置数据出现异常"),n(null),$("#cpsLoading").css("display","none")}})}},{key:"getElementPoints",value:function(e,t){var n=[];if("drawCircle"===t){var o=e.attr("id"),a=parseInt(e.attr("data-starttype")),r=e.attr("points").split(" "),i=parseInt(r[0].split(",")[0]),l=parseInt(r[0].split(",")[1]),d=parseInt(r[r.length-1].split(",")[0]),s=parseInt(r[r.length-1].split(",")[1]);1===a?l-=5:2===a?i+=5:3===a?l+=5:4===a&&(i-=5),n=[{x:i,y:l,lineId:o,index:1},{x:d,y:s,lineId:o,index:2}]}else{var c=e.attr("id"),u=Math.round(e.css("left").replace("px","")),p=Math.round(e.css("top").replace("px","")),f=Math.round(e.css("width").replace("px","")),h=Math.round(e.css("height").replace("px",""));"controlRect"===t&&(n=[{x:u+parseInt(f/2)-3,y:p-3,controlId:c,width:7,height:7,index:1},{x:u+f-4,y:p+parseInt(h/2)-3,controlId:c,width:7,height:7,index:2},{x:u+parseInt(f/2)-3,y:p+h-4,controlId:c,width:7,height:7,index:3},{x:u-3,y:p+parseInt(h/2)-3,controlId:c,width:7,height:7,index:4}]),"zoomCircle"===t&&(n=[{x:u+2,y:p+2,controlId:c,r:5,index:1},{x:u+parseInt(f/2),y:p,controlId:c,r:5,index:2},{x:u+f-2,y:p+2,controlId:c,r:5,index:3},{x:u+f,y:p+parseInt(h/2),controlId:c,r:5,index:4},{x:u+f-2,y:p+h-2,controlId:c,r:5,index:5},{x:u+parseInt(f/2),y:p+h,controlId:c,r:5,index:6},{x:u+2,y:p+h-2,controlId:c,r:5,index:7},{x:u,y:p+parseInt(h/2),controlId:c,r:5,index:8}])}return n}},{key:"showElementPoints",value:function(t,n){var o=e.getElementPoints(t,n);if("drawCircle"===n){for(var a=0;a<o.length;a++)$(d.drawSVGId).find("circle[id='"+n+a+"']").attr({cx:o[a].x,cy:o[a].y,"data-lineid":o[a].lineId});$(d.drawSVGId).find("circle[name='"+n+"']").css("display","block")}else{if("zoomCircle"===n){for(var r=0;r<o.length;r++)$(d.drawSVGId).find("circle[id='"+n+r+"']").attr({cx:o[r].x,cy:o[r].y,"data-controlid":o[r].controlId});$(d.drawSVGId).find("circle[name='"+n+"']").css("display","block")}if("controlRect"===n){for(var i=0;i<o.length;i++)$(d.drawSVGId).find("rect[id='"+n+i+"']").attr({x:o[i].x,y:o[i].y,"data-controlid":o[i].controlId});s.positionRectPoints=o}$(d.drawSVGId).find("rect[name='"+n+"']").css("display","block")}}},{key:"getPolylineStartOrEndPoint",value:function(e,t,n,o){return o?1===n?(e+=3,t+=8):2===n?(e-=1,t+=3):3===n?(e+=3,t-=1):4===n&&(e+=8,t+=3):1===n?(e+=3,t+=4):2===n?(e+=4,t+=3):3===n?(e+=3,t+=4):4===n&&(e+=4,t+=3),e+","+t}},{key:"getPointsByStyle",value:function(e,t,n,o,a,r){var i=e+","+t+" "+n+","+o;switch(a+"_"+r){case"0_0":e!==n&&t!==o&&Math.abs(n-e)>4&&Math.abs(o-t)>4&&(i=e+","+t+" "+e+","+o+" "+n+","+o);break;case"0_1":e!==n&&(i=t>=o?e+","+t+" "+e+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o:e+","+t+" "+n+","+t+" "+n+","+o);break;case"0_2":t!==o&&(i=e>n?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+Math.abs(n+10)+","+t+" "+Math.abs(n+10)+","+o+" "+n+","+o);break;case"0_3":e!==n&&(i=t>o?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+e+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o);break;case"0_4":t!==o&&(i=e>=n?e+","+t+" "+Math.abs(n-10)+","+t+" "+Math.abs(n-10)+","+o+" "+n+","+o:e+","+t+" "+e+","+o+" "+n+","+o);break;case"1_0":e!==n&&(i=t>o?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t-10)+" "+n+","+Math.abs(t-10)+" "+n+","+o);break;case"1_1":e!==n&&(i=t>o?e+","+t+" "+e+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t-10)+" "+n+","+Math.abs(t-10)+" "+n+","+o);break;case"1_2":i=e>n&&t>o?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t-10)+" "+Math.abs(n+10)+","+Math.abs(t-10)+" "+Math.abs(n+10)+","+o+" "+n+","+o;break;case"1_3":i=t>o?e+","+t+" "+e+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t-10)+" "+Math.floor(e+(n-e)/2)+","+Math.abs(t-10)+" "+Math.floor(e+(n-e)/2)+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o;break;case"1_4":i=e<n&&t>o?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t-10)+" "+Math.abs(n-10)+","+Math.abs(t-10)+" "+Math.abs(n-10)+","+o+" "+n+","+o;break;case"2_0":t!==o&&(i=e>=n?e+","+t+" "+Math.abs(e+10)+","+t+" "+Math.abs(e+10)+","+o+" "+n+","+o:e+","+t+" "+n+","+t+" "+n+","+o);break;case"2_1":i=t<o&&e<n?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+Math.abs(e+10)+","+t+" "+Math.abs(e+10)+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o;break;case"2_2":t!==o&&(i=e>=n?e+","+t+" "+Math.abs(e+10)+","+t+" "+Math.abs(e+10)+","+o+" "+n+","+o:e+","+t+" "+Math.abs(n+10)+","+t+" "+Math.abs(n+10)+","+o+" "+n+","+o);break;case"2_3":i=e<n&&t>o?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+Math.abs(e+10)+","+t+" "+Math.abs(e+10)+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o;break;case"2_4":i=e>=n?e+","+t+" "+Math.abs(e+10)+","+t+" "+Math.abs(e+10)+","+Math.floor(t+(o-t)/2)+" "+Math.abs(n-10)+","+Math.floor(t+(o-t)/2)+" "+Math.abs(n-10)+","+o+" "+n+","+o:e+","+t+" "+Math.abs(n-10)+","+t+" "+Math.abs(n-10)+","+o+" "+n+","+o;break;case"3_0":e!==n&&(i=t>=o?e+","+t+" "+e+","+Math.abs(t+10)+" "+n+","+Math.abs(t+10)+" "+n+","+o:e+","+t+" "+e+","+o+" "+n+","+o);break;case"3_1":i=t>=o?e+","+t+" "+e+","+Math.abs(t+10)+" "+Math.floor(e+(n-e)/2)+","+Math.abs(t+10)+" "+Math.floor(e+(n-e)/2)+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o:e+","+t+" "+e+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o;break;case"3_2":i=e>n&&t<o?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t+10)+" "+Math.abs(n+10)+","+Math.abs(t+10)+" "+Math.abs(n+10)+","+o+" "+n+","+o;break;case"3_3":e!==n&&(i=t>=o?e+","+t+" "+e+","+Math.abs(t+10)+" "+n+","+Math.abs(t+10)+" "+n+","+o:e+","+t+" "+e+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o);break;case"3_4":i=e<n&&t<o?e+","+t+" "+e+","+o+" "+n+","+o:e+","+t+" "+e+","+Math.abs(t+10)+" "+Math.abs(n-10)+","+Math.abs(t+10)+" "+Math.abs(n-10)+","+o+" "+n+","+o;break;case"4_0":t!==o&&(i=e>n?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+Math.abs(e-10)+","+t+" "+Math.abs(e-10)+","+o+" "+n+","+o);break;case"4_1":i=e>n&&t<o?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+Math.abs(e-10)+","+t+" "+Math.abs(e-10)+","+Math.abs(o-10)+" "+n+","+Math.abs(o-10)+" "+n+","+o;break;case"4_2":i=e>n?e+","+t+" "+Math.abs(n+10)+","+t+" "+Math.abs(n+10)+","+o+" "+n+","+o:e+","+t+" "+Math.abs(e-10)+","+t+" "+Math.abs(e-10)+","+Math.floor(t+(o-t)/2)+" "+Math.abs(n+10)+","+Math.floor(t+(o-t)/2)+" "+Math.abs(n+10)+","+o+" "+n+","+o;break;case"4_3":i=e>n&&t>o?e+","+t+" "+n+","+t+" "+n+","+o:e+","+t+" "+Math.abs(e-10)+","+t+" "+Math.abs(e-10)+","+Math.abs(o+10)+" "+n+","+Math.abs(o+10)+" "+n+","+o;break;case"4_4":t!==o&&(i=e>n?e+","+t+" "+Math.abs(n-10)+","+t+" "+Math.abs(n-10)+","+o+" "+n+","+o:e+","+t+" "+Math.abs(e-10)+","+t+" "+Math.abs(e-10)+","+o+" "+n+","+o);break;default:i=e+","+t+" "+n+","+o}return i}},{key:"checkProduceLineModel",value:function(e){var t=[];if(e.StartControlId&&e.EndControlId&&e.StartControlId!==e.EndControlId){if(1===s.controlLineModels.FactoryModuleType){var n=e.StartControlId.indexOf(d.comProduceLine),o=e.EndControlId.indexOf(d.comProduceLine),a=e.StartControlId.indexOf(d.comWorkshopSection),r=e.EndControlId.indexOf(d.comWorkshopSection),i=e.StartControlId.indexOf(d.comWorkProcess),l=e.EndControlId.indexOf(d.comWorkProcess),c=e.StartControlId.indexOf(d.comWorkstation),u=e.EndControlId.indexOf(d.comWorkstation);if(0===n&&0!==r||0===r&&0!==n)t.push({kind:1,msg:"只能由生产线组件指向工段组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===a&&0!==l||0===l&&0!==a)t.push({kind:1,msg:"只能由工段组件指向工序组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===i&&0!==u||0===u&&0!==i)t.push({kind:1,msg:"只能由工序组件指向工作站点组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===o&&0===c)t.push({kind:1,msg:"工作站点组件不能指向生产线组件，矢量线【"+e.LineId+"】已为您自动删除！"});else{var p=$(d.drawSVGId).find("polyline[data-startid='"+e.StartControlId+"'][data-endid='"+e.EndControlId+"']"),f=$(d.drawSVGId).find("polyline[data-startid!='"+e.StartControlId+"'][data-endid='"+e.EndControlId+"']");0===r&&(p.length>1||f.length>0)?t.push({kind:1,msg:"同一工段组件只能被一个生产线组件来指向，矢量线【"+e.LineId+"】已为您自动删除！"}):0===l&&(p.length>1||f.length>0)?t.push({kind:1,msg:"同一工序组件只能被一个工段组件来指向，矢量线【"+e.LineId+"】已为您自动删除！"}):0===u&&(p.length>1||f.length>0)&&t.push({kind:1,msg:"同一工作站点组件只能被指向一个工序组件来指向，矢量线【"+e.LineId+"】已为您自动删除！"})}}if(2===s.controlLineModels.FactoryModuleType){var h=e.StartControlId.indexOf(d.comTechRouteType),g=e.EndControlId.indexOf(d.comTechRouteType),m=e.StartControlId.indexOf(d.comTechRoute),v=e.EndControlId.indexOf(d.comTechRoute),y=e.StartControlId.indexOf(d.comWorkshopSection),C=e.EndControlId.indexOf(d.comWorkshopSection),b=e.StartControlId.indexOf(d.comWorkProcess),I=e.EndControlId.indexOf(d.comWorkProcess),x=e.StartControlId.indexOf(d.comWorkstationConfig),E=e.EndControlId.indexOf(d.comWorkstationConfig),w=e.StartControlId.indexOf(d.comMaterialType),S=e.EndControlId.indexOf(d.comMaterialType),M=e.StartControlId.indexOf(d.comMaterial);if(0===g)t.push({kind:1,msg:"只能由标准工艺类型组件指向标准工艺路线组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===E)t.push({kind:1,msg:"只能由站点配置组件指向工序组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===v&&0!==M&&0!==h)t.push({kind:1,msg:"只能由标准工艺类型或物料组件指向标准工艺路线组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===m&&0!==C||0===C&&0!==m)t.push({kind:1,msg:"只能由标准工艺路线组件指向工段组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0!==I&&(0===y||0===x||0===w||0===b)||0!==y&&0!==x&&0!==w&&0!==b&&0===I)t.push({kind:1,msg:"只能由工段或站点配置或物料类别或工序组件指向工序组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===M&&0!==S&&0!==v)t.push({kind:1,msg:"只能由物料组件指向物料类别或标准工艺路线组件，矢量线【"+e.LineId+"】已为您自动删除！"});else{var L=$(d.drawSVGId).find("polyline[data-startid='"+e.StartControlId+"']");if(0===h&&L.length>1)t.push({kind:1,msg:"同一标准工艺类型组件只能指向一个标准工艺路线组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===b&&L.length>1)t.push({kind:1,msg:"同一工序组件只能指向一个工序组件，矢量线【"+e.LineId+"】已为您自动删除！"});else if(0===x&&L.length>1)t.push({kind:1,msg:"同一站点配置组件只能指向一个工序组件，矢量线【"+e.LineId+"】已为您自动删除！"});else{var k=$(d.drawSVGId).find("polyline[data-startid='"+e.StartControlId+"'][data-endid!='"+e.EndControlId+"']");0===m&&0===C&&k.length>1?t.push({kind:1,msg:"同一工段只能被一个标准工艺路线组件组件所指向，矢量线【"+e.LineId+"】已为您自动删除！"}):0===x&&0===I&&k.length>1&&t.push({kind:1,msg:"同一工序只能被一个站点配置组件组件所指向，矢量线【"+e.LineId+"】已为您自动删除！"})}}}}else t.push({kind:1,msg:"矢量线的起始组件、结束组件均不可为空且不可相同，矢量线【"+e.LineId+"】已为您自动删除！"});return t}},{key:"checkProduceControlLineModels",value:function(){var t=[];if(s.controlLineModels.ControlDetail.length>0&&s.controlLineModels.VectorLineDetail.length>0){for(var n=[],o=[],a=0;a<s.controlLineModels.ControlDetail.length;a++){var r=s.controlLineModels.ControlDetail[a];-1!==$.inArray(r.ControlId,o)?($(d.canvasId).find("div[id='"+r.ControlId+"']").remove(),l.a.deletePolylineByControlId(r.ControlId),t.push({kind:2,msg:"组件的ID已存在，组件【"+r.ControlName+"】已为您自动删除！"})):(r.RelId||t.push({kind:1,msg:"组件【"+r.ControlName+"】的关联主数据ID不可为空"}),o.push(r.ControlId),n.push(r))}s.controlLineModels.ControlDetail=n;for(var i=[],c=[],u=0;u<s.controlLineModels.VectorLineDetail.length;u++){var p=s.controlLineModels.VectorLineDetail[u],f=e.checkProduceLineModel(p);f.length>0?($(d.drawSVGId).find("polyline[id='"+p.LineId+"']").remove(),t=t.concat(f)):-1===$.inArray(p.StartControlId,o)||-1===$.inArray(p.EndControlId,o)?($(d.drawSVGId).find("polyline[id='"+p.LineId+"']").remove(),t.push({kind:1,msg:"矢量线的起始组件、结束组件需跟画板中的组件关联的规则，矢量线【"+p.LineId+"】已为您自动删除！"})):-1!==$.inArray(p.LineId,c)?($(d.drawSVGId).find("polyline[id='"+p.LineId+"']").remove(),t.push({kind:1,msg:"矢量线的ID已存在，矢量线【"+p.LineId+"】已为您自动删除！"})):(c.push(p.LineId),i.push(p))}s.controlLineModels.VectorLineDetail=i,$(d.drawSVGId).find("circle[name='drawCircle']").css({display:"none"}),s.polylineAttrPanel.getForm().reset()}else t.push({kind:2,msg:"画板中须存在组件以及其矢量线，否则无法继续操作！"});return t}},{key:"saveProduceControlLineModels",value:function(){Ext.Ajax.request({url:"/CpsModule/SaveProduceControlLine",jsonData:{info:s.controlLineModels},method:"POST",async:!1,timeout:9e7,success:function(t){var n=Ext.decode(t.responseText);if(n.Messages.length>0){for(var o=[],a=0;a<n.Messages.length;a++)o.push({kind:n.Messages[a].MessageKind,msg:n.Messages[a].Message});Ax.utils.LibMsg.show(o)}else{if(e.removeControlSelStyle(),s.polylineAttrPanel.getForm().reset(),s.controlLineModels=n.Result,s.masterVcl){var r=s.masterVcl.invorkBcf("BrowseTo",[s.masterVcl.currentPk]);s.masterVcl.setDataSet(r,!1);for(var i=s.masterVcl.dataSet.getTable(0).data.items[0],l=0;l<s.masterVcl.forms.length;l++)s.masterVcl.forms[l].loadRecord(i)}Ext.Msg.alert("提示","CPS产线建模成功")}},failure:function(e){Ext.decode(e.responseText);Ext.Msg.alert("提示",e.responseText)}})}},{key:"removeControlSelStyle",value:function(){$(d.canvasId).find("div.cps-controls-region").css({"background-color":"#eceff4",border:"1px solid #bbcfde"}),s.controlsAttrPanel.getForm().reset()}},{key:"randomString",value:function(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,o="",a=0;a<e;a++)o+=t.charAt(Math.floor(Math.random()*n));return o}},{key:"canUseFunc",value:function(e){var t=!1;return Ext.Ajax.request({url:"/billSvc/canUseFunc",method:"POST",jsonData:{handle:UserHandle,progId:e},async:!1,timeout:9e7,success:function(e){var n=Ext.decode(e.responseText);t=n.CanUseFuncResult},failure:function(e){Ext.Msg.alert("提示","当前功能不具有使用权限"),t=!1}}),t}},{key:"getFilterCob",value:function(){var e=Ext.create("Ext.data.Store",{fields:["key","value"],data:[{key:"all",value:"无"}],proxy:{type:"memory",reader:{type:"json"}}});return Ext.create("Ext.form.field.ComboBox",{fieldLabel:"字段",labelAlign:"right",labelWidth:60,margin:"0 2 2 2",flex:1,queryMode:"local",displayField:"value",valueField:"key",store:e,editable:!1,value:"all"})}},{key:"getCompareCbo",value:function(){var e=Ext.create("Ext.data.Store",{fields:["key","value"],data:[{key:0,value:"包含"},{key:1,value:"等于"},{key:2,value:"大于等于"},{key:3,value:"小于等于"},{key:4,value:"大于"},{key:5,value:"小于"}]});return Ext.create("Ext.form.field.ComboBox",{labelWidth:60,labelAlign:"right",margin:"0 2 2 2",fieldLabel:"比较符",flex:1,displayField:"value",queryMode:"local",valueField:"key",store:e,editable:!1,value:0})}},{key:"getCompareTxt",value:function(){return Ext.create("Ext.form.field.Text",{labelWidth:60,labelAlign:"right",margin:"0 2 2 2",flex:2})}},{key:"getDateCbo",value:function(){var e=Ext.create("Ext.data.Store",{fields:["key","value"],data:[{key:0,value:"无"},{key:1,value:"近一周"},{key:2,value:"近一月"},{key:3,value:"近三月"}]});return Ext.create("Ext.form.field.ComboBox",{labelWidth:60,labelAlign:"right",margin:"0 2 2 2",fieldLabel:"时间",flex:1,displayField:"value",queryMode:"local",valueField:"key",store:e,editable:!1,value:0})}}]),e}()},559:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=n(562),s=n(567),c=n(560),u=(n(561),function(){function e(){a()(this,e)}return i()(e,null,[{key:"createMainPanel",value:function(){var t=l.c.mainPanelId.replace("#",""),n=l.c.controlsId.replace("#",""),o=l.c.canvasId.replace("#",""),a='<div class="cps-controls-layout" id="'+t+'" style="width:100%;height:100%;">';return a=a+'<aside class="cps-controls-layout-aside" id="'+n+'">'+e.getControlConfigureVue()+"</aside>",a=a+'<div class="cps-controls-layout-main" id="'+o+'" tabindex="0" style="position:relative;overflow:overlay;">',a+="</div>",a+='<div id="cpsLoading" class="cps-loading"><i class="fa fa-refresh fa-spin"></i></div>',a+="</div>",Ext.create("Ext.panel.Panel",{border:!1,height:"100%",flex:1,html:a})}},{key:"getControlConfigureVue",value:function(){var e=l.c.cpsControlsId.replace("#",""),t=l.c.sysControlsId.replace("#",""),n=parseInt($(".content-section").css("height").replace("px",""))-70-130-50-10,o='<ul class="cps-controls-sidebar" style="width:100%;height:100%;">';return o+="<li>",o+='<div class="cps-controls-title" name="cpsControlTitle">',o+="<span>CPS组件</span>",o+='<img src="/Scripts/img/cps/less_than.png" class="cps-controls-openimg cps-controls-angle" name="cpsImage"></span>',o+="</div>",o=o+'<div class="cps-controls-table" id="'+e+'" name="cpsControls" style="display:block;max-height:'+n+'px;overflow-y:auto;">',o+="</div>",o+="</li>",o+='<li style="margin-top:5px;">',o+='<div class="cps-controls-title" name="cpsControlTitle">',o+="<span>系统组件</span>",o+='<img src="/Scripts/img/cps/less_than.png" class="cps-controls-openimg cps-controls-angle" name="cpsImage"></span>',o+="</div>",o=o+'<div class="cps-controls-table" id="'+t+'" name="cpsControls" style="display:block;height: 130px;">',o+="</div>",o+="</li>",o+="</ul>"}},{key:"getSvgLayoutVue",value:function(){var e=l.c.drawSVGId.replace("#",""),t='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute;left:0px;top:0px;width:100%;height:100%;" id="'+e+'">';return t+="<defs>",t+='<marker id="markerArrow" markerUnits="strokeWidth" markerWidth="8" markerHeight="8" viewBox="0 0 12 12" refX="6" refY="6" orient="auto">',t+='<path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: red;" />',t+="</marker>",t+="</defs>",t+='<circle id="drawCircle0" name="drawCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="0" style="display:none;cursor: sw-resize;" data-lineid=""/>',t+='<circle id="drawCircle1" name="drawCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="1" style="display:none;cursor: se-resize;" data-lineid=""/>',t+='<rect id="controlRect0" name="controlRect" x="0" y="0" width="7" height="7" fill="#ffffff" stroke="#ff0000" stroke-width="1" data-index="1" style="display:none;cursor: pointer;" data-controlid=""/>',t+='<rect id="controlRect1" name="controlRect" x="0" y="0" width="7" height="7" fill="#ffffff" stroke="#ff0000" stroke-width="1" data-index="2" style="display:none;cursor: pointer;" data-controlid=""/>',t+='<rect id="controlRect2" name="controlRect" x="0" y="0" width="7" height="7" fill="#ffffff" stroke="#ff0000" stroke-width="1" data-index="3" style="display:none;cursor: pointer;" data-controlid=""/>',t+='<rect id="controlRect3" name="controlRect" x="0" y="0" width="7" height="7" fill="#ffffff" stroke="#ff0000" stroke-width="1" data-index="4" style="display:none;cursor: pointer;" data-controlid=""/>',t+='<circle id="zoomCircle0" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="1" style="display:none;cursor: se-resize;" data-controlid=""/>',t+='<circle id="zoomCircle1" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="2" style="display:none;cursor: s-resize;" data-controlid=""/>',t+='<circle id="zoomCircle2" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="3" style="display:none;cursor: sw-resize;" data-controlid=""/>',t+='<circle id="zoomCircle3" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="4" style="display:none;cursor: w-resize;" data-controlid=""/>',t+='<circle id="zoomCircle4" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="5" style="display:none;cursor: se-resize;" data-controlid=""/>',t+='<circle id="zoomCircle5" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="6" style="display:none;cursor: s-resize;" data-controlid=""/>',t+='<circle id="zoomCircle6" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="7" style="display:none;cursor: sw-resize;" data-controlid=""/>',t+='<circle id="zoomCircle7" name="zoomCircle" cx="0" cy="0" r="5" stroke="#3c8dbc" fill="#ffffff" stroke-width="1" data-index="8" style="display:none;cursor: w-resize;" data-controlid=""/>',t+="</svg>"}},{key:"loadCanvasVue",value:function(t){var n=e.getSvgLayoutVue();if($(l.c.canvasId).empty().append(n),t){var o=e.loadCanvasControlsVue(t);$(l.c.canvasId).append(o),e.loadCanvasSvgVue(t)}}},{key:"loadCanvasControlsVue",value:function(e){for(var t="",n=0;n<e.ControlDetail.length;n++){var o=e.ControlDetail[n],a=o.ControlWidth>o.ControlHeight?o.ControlHeight:o.ControlWidth;t=t+'<div class="cps-controls-td" name="cpsIcon" style="width:'+o.ControlWidth+"px;height:"+o.ControlHeight+"px;position:absolute;margin:0px;left:"+o.XCoordinate+"px;top:"+o.YCoordinate+'px;"  draggable="true" id="'+o.ControlId+'" data-relid="'+o.RelId+'" data-progid="'+o.ProgId+'">',t+='<div class="cps-controls-region" style="border:1px solid #d2c06c;">',t=t+'<img src="'+o.RelIcon+'" style="width: '+(a-30)+"px;height:"+(a-30)+'px;"/>',t=t+'<div class="cps-controls-span">'+o.ControlName+"</div>",t+="</div>",t+="</div>"}return t}},{key:"loadCanvasSvgVue",value:function(e){for(var t=0;t<e.VectorLineDetail.length;t++){var n=e.VectorLineDetail[t],o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o&&(o.setAttribute("name","drawLine"),o.setAttribute("id",n.LineId),o.setAttribute("points",n.Coordinates),o.setAttribute("data-startid",n.StartControlId),o.setAttribute("data-endid",n.EndControlId),o.setAttribute("data-starttype",n.ControlStartType),o.setAttribute("data-endtype",n.ControlEndType),o.setAttribute("marker-end","url(#markerArrow)"),o.setAttribute("style","fill:none;stroke:red;stroke-width:2;cursor:move;"),$(l.c.drawSVGId).append(o))}}},{key:"resizeDrawSvg",value:function(t){if(t&&0!==t.length){var n=e.minWidth,o=e.minHeight,a=Math.round(t.css("left").replace("px",""))+Math.round(t.css("width").replace("px","")),r=Math.round(t.css("top").replace("px",""))+Math.round(t.css("height").replace("px",""));n=a+20>n?n+200:n,o=r+20>o?o+200:o,n=l.b.drawSvgWidth>n?l.b.drawSvgWidth:n,o=l.b.drawSvgHeight>o?l.b.drawSvgHeight:o,$(l.c.drawSVGId).css({width:n,height:o}),e.minWidth=n,e.minHeight=o}}},{key:"setSizeDrawSvg",value:function(){for(var t=e.minWidth,n=e.minHeight,o=0,a=0,r=0;r<l.b.controlLineModels.ControlDetail.length;r++){var i=l.b.controlLineModels.ControlDetail[r];o=i.XCoordinate+i.ControlWidth>o?i.XCoordinate+i.ControlWidth:o,a=i.YCoordinate+i.ControlHeight>a?i.YCoordinate+i.ControlHeight:a}for(var d=0;d<l.b.controlLineModels.VectorLineDetail.length;d++)for(var s=l.b.controlLineModels.VectorLineDetail[d],c=s.Coordinates.split(" "),u=0;u<c.length;u++){var p=parseInt(c[u].split(",")[0]),f=parseInt(c[u].split(",")[1]);o=p>o?p:o,a=f>a?f:a}for(;t-200>o+20;)t-=200;for(;n-200>a+20;)n-=200;t=l.b.drawSvgWidth>t?l.b.drawSvgWidth:t,n=l.b.drawSvgHeight>n?l.b.drawSvgHeight:n,$(l.c.drawSVGId).css({width:t,height:n}),e.minWidth=t,e.minHeight=n}},{key:"initSizeDrawSvg",value:function(){var t=$(l.c.canvasId)[0],n=t.offsetWidth-2>t.scrollWidth?t.offsetWidth-2:t.scrollWidth,o=t.offsetHeight>t.scrollHeight?t.offsetHeight:t.scrollHeight;$(l.c.drawSVGId).css({width:n,height:o}),l.b.drawSvgWidth=n,l.b.drawSvgHeight=o,e.minWidth=n,e.minHeight=o}},{key:"clearElementBindEvent",value:function(){$(l.b.renderTo).unbind("contextmenu"),$(l.b.renderTo).unbind("mouseup"),$(l.c.controlsId).find("div[name='cpsControlTitle']").unbind("click"),$(l.c.canvasId).unbind("keydown"),$(l.c.drawSVGId).find("circle[name='zoomCircle']").unbind("mousedown"),$(l.c.drawSVGId).find("circle[name='drawCircle']").unbind("mousedown"),$(l.c.drawSVGId).find("polyline[name='drawLine']").unbind("click"),$(l.c.canvasId).unbind("mousedown"),$(l.c.canvasId).unbind("mousemove"),$(l.c.canvasId).unbind("mouseup"),$(l.c.mainPanelId).find("div[name='cpsIcon']").unbind("dragstart"),$(l.c.mainPanelId).find("div[name='cpsIcon']").unbind("dragend"),$(l.c.canvasId).unbind("dragenter"),$(l.c.canvasId).unbind("dragover"),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseup"),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("click"),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("dblclick"),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseenter"),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseleave"),$(l.c.drawSVGId).find("polyline[name='drawLine']").unbind("click"),$("#descriptionBox").unbind("click"),$("#pointerTool").unbind("click"),$("#vectorLine").unbind("click")}},{key:"selFactoryModuleType",value:function(t,n){var o=Ext.create("Ext.data.Store",{fields:["Name","Value"],data:[{Name:"无",Value:0},{Name:"产线配置",Value:1},{Name:"标准工艺路线",Value:2}]}),a=Ext.create("Ext.form.Panel",{bodyPadding:5,width:"100%",height:"100%",defaults:{anchor:"100%"},cls:"cps-x-panel",items:[{xtype:"combobox",name:"FactoryModuleType",fieldLabel:"工厂建模模型",store:o,displayField:"Name",valueField:"Value",value:0,triggerAction:"all",editable:!1,mode:"local",queryMode:"local"}],buttons:[{xtype:"button",text:"确认",scale:"medium",handler:function(){var o=this.up("form").getForm().findField("FactoryModuleType").getValue();e.loadCpsConfigureView(t,o,n);var a=1!==o;d.a.sysEventPanel.items.getAt(5).setDisabled(a),e.factoryModuleTypeWin.close()}}]});e.factoryModuleTypeWin=Ext.create("Ext.window.Window",{title:"CPS建模的模型选择",height:150,width:300,closable:!1,layout:"fit",items:[a]}),e.factoryModuleTypeWin.show()}},{key:"loadCpsConfigureView",value:function(t,n,o){$("#cpsLoading").css("display","block"),e.clearElementBindEvent(),window.clearInterval(d.a.taskNoTipInterval),l.a.getProduceControlLineList(t,function(t){e.loadCanvasVue(t),l.a.getCpsControlConfigureList(l.b.controlLineModels.ControlConfigId,n,function(t){s.a.loadControlConfigVue(t,!0),d.a.loadCpsConfigureEvent(),$("#cpsLoading").css("display","none"),e.initSizeDrawSvg()}),l.b.controlsAttrPanel.getForm().reset(),l.b.polylineAttrPanel.getForm().reset()}),l.b.masterVcl=o}},{key:"showProduceControlLineModels",value:function(){var t=.8*document.body.clientWidth,n=.7*document.body.clientHeight,o='<div class="cps-controls-layout-main" style="min-height:'+(n-41)+"px;min-width:"+(t-11)+'px;position:relative;overflow:auto;" id="cps_cavasId">';if(l.b.controlLineModels&&l.b.controlLineModels.ControlDetail.length>0&&(o+=e.loadCanvasControlsVue(l.b.controlLineModels)),l.b.controlLineModels&&l.b.controlLineModels.VectorLineDetail.length>0){o+='<svg xmlns="http://www.w3.org/2000/svg"  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="100%" height="100%" style="position: absolute;" id="cps_svgId">',o+='<defs><marker id="arrowPoint" markerUnits="strokeWidth" markerWidth="8" markerHeight="8" viewBox="0 0 12 12" refX="6" refY="6" orient="auto">',o+='<path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: red;" /></marker></defs>';for(var a=0;a<l.b.controlLineModels.VectorLineDetail.length;a++){var r=l.b.controlLineModels.VectorLineDetail[a];o=o+'<polyline name="drawLine" id="'+r.LineId+'" points="'+r.Coordinates+'" data-startid="'+r.StartControlId+'" data-endid="'+r.EndControlId+'" data-starttype="'+r.ControlStartType+'" data-endtype="'+r.ControlEndType+'" marker-end="url(#arrowPoint)" style="fill:none;stroke:red;stroke-width:2;" />'}o+="</svg>"}o+="</div>";var i=Ext.create("Ext.panel.Panel",{border:!1,width:"100%",height:"100%",html:o}),d="CPS产线模型配置";l.b.controlLineModels.ProduceControlLineName&&(d=l.b.controlLineModels.ProduceControlLineName),Ext.create("Ext.window.Window",{title:d,titleAlign:"center",constrain:!0,closable:!0,draggable:!0,resizable:!1,width:t,height:n,border:!1,layout:"fit",items:i}).show(),$("#cps_svgId").attr({height:$("#cps_cavasId")[0].scrollHeight+"px",width:$("#cps_cavasId")[0].scrollWidth+"px"})}},{key:"FillTechRouteGridData",value:function(e,t){var n=e.dataSet.getTable(0).data.items[0];n.set("TECHROUTEID",t.TechRouteId),n.set("TECHROUTENAME",t.TechRouteName),n.set("TECHROUTETYPEID",t.TechRouteTypeId),n.set("TECHROUTETYPENAME",t.TechRouteTypeName),n.set("ISPARALLELTECHROUTE",t.IsParallelTechRoute),n.set("BIZATTR",t.BizAttr),n.set("VERSION",t.Version),n.set("MATERIALID",t.MaterialId),n.set("MATERIALNAME",t.MaterialName),n.set("MATERIALSPEC",t.MaterialSpec),n.set("UNITID",t.UnitId),n.set("UNITNAME",t.UnitName),e.forms[0].loadRecord(n),Ext.suspendLayouts();var o=e.dataSet.getTable(1);o.suspendEvents();try{e.dataSet.getTable(1).removeAll(),e.dataSet.getTable(2).removeAll();var a=e.dataSet.getTable(0).data.items[0];if(void 0!=t&&t.WorkProcessDetail.length>0)for(var r=0;r<t.WorkProcessDetail.length;r++){var i=t.WorkProcessDetail[r],l=e.addRow(a,1);l.set("TECHROUTEID",i.TechRouteId),l.set("ROW_ID",i.RowId),l.set("ROWNO",i.RowNo),l.set("WORKSHOPSECTIONID",i.WorkShopSectionId),l.set("WORKSHOPSECTIONNAME",i.WorkShopSectionName),l.set("WORKPROCESSID",i.WorkProcessId),l.set("WORKPROCESSNAME",i.WorkProcessName),l.set("PRODUCTDETAIL",i.ProductDetail),l.set("WORKSTATIONCONFIGID",i.WorkStationConfigId),l.set("WORKSTATIONCONFIGNAME",i.WorkStationConfigName),l.set("WORKPROCESSNO",i.WorkProcessNo),l.set("TRANSFERWORKPROCESSNO",i.TransferWorkProcessNo),l.set("NEEDGATHER",i.NeedGather),l.set("DOWORKPROCESS",i.DoWorkProcess);for(var d=0;d<i.ProductOuterDetail.length;d++){var s=i.ProductOuterDetail[d],c=e.addRow(l,2);c.set("TECHROUTEID",s.TechRouteId),c.set("PARENTROWID",s.ParentRowId),c.set("ROW_ID",s.RowId),c.set("ROWNO",s.RowNo),c.set("MATERIALID",s.MaterialId),c.set("MATERIALNAME",s.MaterialName),c.set("MATERIALTYPEID",s.MaterialTypeId),c.set("MATERIALTYPENAME",s.MaterialTypeName),c.set("ISPRODUCT",s.IsProduct)}}}finally{o.resumeEvents(),o.ownGrid&&null!=o.ownGrid.getView().store&&o.ownGrid.reconfigure(o),Ext.resumeLayouts(!0)}}},{key:"buildControlLayout",value:function(t,n,o,a,r){var i=void 0;if(r)for(var d=0;d<l.b.controlLineModels.VectorLineDetail.length;d++){var s=l.b.controlLineModels.VectorLineDetail[d];if(s.EndControlId===t&&0===s.StartControlId.indexOf(l.c.comMaterial)){for(var u=0;u<l.b.controlLineModels.ControlDetail.length;u++){var p=l.b.controlLineModels.ControlDetail[u];if(p.ControlId===s.StartControlId){i=p.RelId;break}}break}}r&&!i?Ext.Msg.alert("提示","复制当前标准工艺路线需要先关联上物料数据"):e.getTechRouteData(o,i,r,function(o){c.a.setControlRelIdName(t,n,o.TechRouteId,o.TechRouteName),e.resetTechRouteLayout(t,o)})}},{key:"getTechRouteData",value:function(e,t,n,o){Ext.Ajax.request({url:"/CpsModule/GetTechRouteInfoById",jsonData:{techRouteId:e,materialId:t,isCopy:n},method:"POST",async:!1,timeout:9e7,success:function(e){var t=Ext.decode(e.responseText);if(t.Messages.length>0){for(var n=[],a=0;a<t.Messages.length;a++)n.push({kind:t.Messages[a].MessageKind,msg:t.Messages[a].Message});Ax.utils.LibMsg.show(n)}else{var r=t.Result;o(r)}},failure:function(t){var o=Ext.decode(t.responseText);o.Messages.length>0?Ext.Msg.alert("异常提示",o.Messages[0].Message):n?Ext.Msg.alert("提示","复制当前标准工艺路线["+e+"]数据出现异常"):Ext.Msg.alert("提示","获取当前标准工艺路线["+e+"]数据出现异常")}})}},{key:"resizeTechRouteControl",value:function(e,t){for(var n=void 0,o=0,a=0;a<t.WorkShopSectionDetail.length;a++){o+=t.WorkShopSectionDetail[a].WorkProcessNodeList.length}for(var r=0;r<l.b.controlLineModels.ControlDetail.length;r++){var i=l.b.controlLineModels.ControlDetail[r];if(i.ControlId===e){var d=!(i.ControlWidth>i.ControlHeight),s=d?20:10,c=d?10:20,u=l.c.workProcessSize+l.c.materialSize+l.c.materialTypeSize+l.c.workstationConfigSize;u=d?u+4*c:u+4*s;var p=d?o*u-c:o*u-s,f=d?l.c.techRouteTypeSize+s+10:10,h=d?10:l.c.techRouteTypeSize+c+10;i.XCoordinate=d?i.XCoordinate>f?i.XCoordinate:f:i.XCoordinate>10?i.XCoordinate:10,i.YCoordinate=d?i.YCoordinate>10?i.YCoordinate:10:i.YCoordinate>h?i.YCoordinate:h,i.ControlWidth=d?70:p,i.ControlHeight=d?p:70;var g=$(l.c.canvasId).find("div[id='"+i.ControlId+"']");g.css({width:i.ControlWidth+"px",height:i.ControlHeight+"px",left:i.XCoordinate+"px",top:i.YCoordinate+"px"}),g.find("img").css({width:"40px",height:"40px"}),n={isVerticalLayout:d,x:i.XCoordinate,y:i.YCoordinate,w:i.ControlWidth,h:i.ControlHeight,hSpace:s,vSpace:c,size:u};break}}return n}},{key:"resetTechRouteLayout",value:function(t,n){e.controlAttrArr=[],e.clearElementBindEvent(),e.delAllTechRouteControlLines(t),l.a.removeControlSelStyle();var o=e.resizeTechRouteControl(t,n);if(!o)return void Ext.Msg.alert("提示","标准工艺路线["+t+"]数据出现异常");var a=o.size,r=o.isVerticalLayout?parseInt((o.h-o.vSpace)/2):l.c.techRouteTypeSize,i=o.isVerticalLayout?l.c.techRouteTypeSize:parseInt((o.w-o.hSpace)/2),s=o.isVerticalLayout?o.x-i-o.hSpace:o.x,c=o.isVerticalLayout?o.y:o.y-r-o.vSpace,u=o.isVerticalLayout?"2-4":"3-1",p=e.createCpsControl(s,c,i,r,l.c.comTechRouteType,n.TechRouteTypeId,n.TechRouteTypeName);e.createVectorLine(p,t,u);var f=o.isVerticalLayout?s:s+o.w-i,h=o.isVerticalLayout?c+o.h-r:c,g=o.isVerticalLayout?"2-4":"3-1",m=e.createCpsControl(f,h,i,r,l.c.comMaterial,n.MaterialId,n.MaterialName);e.createVectorLine(m,t,g);for(var v=0,y=0;y<n.WorkShopSectionDetail.length;y++){var C=n.WorkShopSectionDetail[y],b=o.isVerticalLayout?l.c.workshopSectionSize:C.WorkProcessNodeList.length*a-o.hSpace,I=o.isVerticalLayout?C.WorkProcessNodeList.length*a-o.vSpace:l.c.workshopSectionSize,x=o.isVerticalLayout?o.x+o.w+o.hSpace:o.x+v*a,E=o.isVerticalLayout?o.y+v*a:o.y+o.w+o.vSpace,w=o.isVerticalLayout?"2-4":"3-1",S=e.createCpsControl(x,E,b,I,l.c.comWorkshopSection,C.WorkShopSectionId,C.WorkShopSectionName);e.createVectorLine(t,S,w);for(var M=0;M<C.WorkProcessNodeList.length;M++){var L=C.WorkProcessNodeList[M],k=L.WorkProcess,T=L.WorkProcessChild,P=o.isVerticalLayout?l.c.workstationConfigSize:160,A=o.isVerticalLayout?160:l.c.workstationConfigSize,V=o.isVerticalLayout?x+b+o.hSpace:x+M*a+A+o.hSpace,R=o.isVerticalLayout?E+M*a+P+o.vSpace:E+I+o.vSpace;e.createWorkProcessControls(o,S,k,T,V,R)}v=C.WorkProcessNodeList.length+v}d.a.loadCpsConfigureEvent()}},{key:"createWorkProcessControls",value:function(t,n,o,a,r,i){var d=t.isVerticalLayout?l.c.workProcessSize:160,s=t.isVerticalLayout?160:l.c.workProcessSize,c=t.isVerticalLayout?"2-4":"3-1",u=e.createCpsControl(r,i,s,d,l.c.comWorkProcess,o.WorkProcessId,o.WorkProcessName);if(e.createVectorLine(n,u,c),o.WorkStationConfigId){var p=t.isVerticalLayout?l.c.workstationConfigSize:160,f=t.isVerticalLayout?160:l.c.workstationConfigSize,h=t.isVerticalLayout?r:r-f-t.hSpace,g=t.isVerticalLayout?i-p-t.vSpace:i,m=t.isVerticalLayout?"3-1":"2-4",v=e.createCpsControl(h,g,f,p,l.c.comWorkstationConfig,o.WorkStationConfigId,o.WorkStationConfigName);e.createVectorLine(v,u,m)}for(var y=0;y<o.ProductOuterDetail.length;y++){var C=o.ProductOuterDetail[y];if(C.MaterialTypeId){var b=t.isVerticalLayout?l.c.materialTypeSize:160,I=t.isVerticalLayout?160:l.c.materialTypeSize,x=t.isVerticalLayout?r+y*(s+t.hSpace):r+s+t.hSpace,E=t.isVerticalLayout?i+d+t.vSpace:i+y*(d+t.vSpace),w=t.isVerticalLayout?"1-3":"4-2",S=e.createCpsControl(x,E,I,b,l.c.comMaterialType,C.MaterialTypeId,C.MaterialTypeName);if(e.createVectorLine(S,u,w),C.MaterialId){var M=t.isVerticalLayout?l.c.materialSize:160,L=t.isVerticalLayout?160:l.c.materialSize,k=t.isVerticalLayout?x:x+I+t.hSpace,T=t.isVerticalLayout?E+b+t.vSpace:E,P=t.isVerticalLayout?"1-3":"4-2",A=e.createCpsControl(k,T,L,M,l.c.comMaterial,C.MaterialId,C.MaterialName);e.createVectorLine(A,S,P)}}}for(var V=void 0,R=0;R<a.length;R++)if(o.TransferWorkProcessNo===a[R].WorkProcessNo){V=a[R];for(var N=0;N<e.controlAttrArr.length;N++){var O=e.controlAttrArr[N];if(O.relId===V.WorkProcessId&&O.controlFilter===l.c.comWorkProcess&&O.relName===V.WorkProcessName){e.createVectorLine(u,O.controlId,c),V=void 0;break}}break}V&&(r=t.isVerticalLayout?r+s+t.hSpace:r,i=t.isVerticalLayout?i:i+d+t.vSpace,e.createWorkProcessControls(t,u,V,a,r,i))}},{key:"createCpsControl",value:function(t,n,o,a,r,i,d){for(var s=void 0,u=0;u<e.controlAttrArr.length;u++){var p=e.controlAttrArr[u];if(p.relId===i&&p.controlFilter===r&&p.relName===d){p.OccurrenceTimes=p.OccurrenceTimes+1,s=p.controlId;break}}if(!s){var f=r.substring(0,r.length-1),h=$(l.c.cpsControlsId).find("div[id='"+f+"']").clone();if(h){for(s=f+"_"+parseInt(1e3*Math.random());$(l.c.canvasId).find("div[id='"+id+"']").length>0;)s=f+"_"+parseInt(1e3*Math.random());var g=o>a?a-30:o-30,m=h.find("div.cps-controls-span").text()+"["+d+"]";h=h.attr({id:s,"data-relid":i}),h.css({position:"absolute",margin:"0",width:o+"px",height:a+"px",left:t+"px",top:n+"px"}),h.find("div.cps-controls-region").css("border","1px solid #d2c06c"),h.find("img").css({width:g+"px",height:g+"px"}),h.find("div.cps-controls-span").text(m);var v=c.a.getControlAttr(h);l.b.controlLineModels.ControlDetail.push(v),$(l.c.canvasId).append(h),e.resizeDrawSvg(h);var y={x:t,y:n,w:o,h:a,controlId:s,relId:i,relName:d,controlFilter:r,OccurrenceTimes:1};e.controlAttrArr.push(y)}}return s}},{key:"createVectorLine",value:function(e,t,n){var o=$(l.c.drawSVGId).find("polyline[data-startid='"+e+"'][data-endid='"+t+"']");if(!(o&&o.length>0)){var a=$(l.c.canvasId).find("div[id='"+e+"']"),r=$(l.c.canvasId).find("div[id='"+t+"']"),i=parseInt(n.split("-")[0]),s=parseInt(n.split("-")[1]);if(a&&r){var c=l.a.getElementPoints(a,"controlRect"),u=l.a.getElementPoints(r,"controlRect"),p=i-1,f=s-1,h=l.a.getPolylineStartOrEndPoint(c[p].x,c[p].y,i,!0),g=l.a.getPolylineStartOrEndPoint(u[f].x,u[f].y,s,!1),m=parseInt(h.split(",")[0]),v=parseInt(h.split(",")[1]),y=parseInt(g.split(",")[0]),C=parseInt(g.split(",")[1]),b=l.a.getPointsByStyle(m,v,y,C,i,s),I=d.a.createSvgPolyline(b,e,i,t,s);if(I){$(l.c.drawSVGId).append(I);var x={ProduceControlLineId:"",RowId:0,RowNo:0,StartControlId:e,EndControlId:t,LineId:$(I).attr("id"),Coordinates:b,ControlStartType:i,ControlEndType:s};l.b.controlLineModels.VectorLineDetail.push(x)}}}}},{key:"delAllTechRouteControlLines",value:function(t){for(var n=[],o=[],a=[],r=0;r<l.b.controlLineModels.VectorLineDetail.length;r++){var i=l.b.controlLineModels.VectorLineDetail[r];i.EndControlId!==t||0!==i.StartControlId.indexOf(l.c.comMaterial)&&0!==i.StartControlId.indexOf(l.c.comTechRouteType)?i.StartControlId===t&&0===i.EndControlId.indexOf(l.c.comWorkshopSection)?($(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").remove(),n.push(i.EndControlId),o.push(i.EndControlId)):a.push(i):($(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").remove(),n.push(i.StartControlId))}for(var d=[],s=[],c=0;c<a.length;c++){var u=a[c];-1!==$.inArray(u.StartControlId,o)&&0===u.EndControlId.indexOf(l.c.comWorkProcess)?($(l.c.drawSVGId).find("polyline[id='"+u.LineId+"']").remove(),n.push(u.EndControlId),d.push(u.EndControlId)):s.push(u)}for(l.b.controlLineModels.VectorLineDetail=s;d.length>0;)d=e.delWorkProcessRelLines(d,n);for(var p=[],f=0;f<l.b.controlLineModels.ControlDetail.length;f++){var h=l.b.controlLineModels.ControlDetail[f];-1!==$.inArray(h.ControlId,n)?$(l.c.canvasId).find("div[id='"+h.ControlId+"']").remove():p.push(h)}l.b.controlLineModels.ControlDetail=p}},{key:"delWorkProcessRelLines",value:function(e,t){for(var n=[],o=[],a=[],r=0;r<l.b.controlLineModels.VectorLineDetail.length;r++){var i=l.b.controlLineModels.VectorLineDetail[r];-1!==$.inArray(i.EndControlId,e)&&0===i.StartControlId.indexOf(l.c.comWorkstationConfig)?($(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").remove(),t.push(i.StartControlId)):-1!==$.inArray(i.EndControlId,e)&&0===i.StartControlId.indexOf(l.c.comMaterialType)?($(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").remove(),t.push(i.StartControlId),o.push(i.StartControlId)):-1!==$.inArray(i.StartControlId,e)&&0===i.EndControlId.indexOf(l.c.comWorkProcess)?($(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").remove(),t.push(i.EndControlId),n.push(i.EndControlId)):a.push(i)}for(var d=[],s=0;s<a.length;s++){var c=a[s];-1!==$.inArray(c.EndControlId,o)&&0===c.StartControlId.indexOf(l.c.comMaterial)?($(l.c.drawSVGId).find("polyline[id='"+c.LineId+"']").remove(),t.push(c.StartControlId)):d.push(c)}return l.b.controlLineModels.VectorLineDetail=d,n}}]),e}());u.minWidth=0,u.minHeight=0,u.factoryModuleTypeWin=null,u.controlAttrArr=[]},560:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=n(559),s=n(561),c=function(){function e(){a()(this,e)}return i()(e,null,[{key:"createControlAttrPanel",value:function(){return l.b.controlsAttrPanel=Ext.create("Ext.form.Panel",{id:"cpsControlAttr-panel",title:"CPS组件属性",bodyPadding:5,width:"100%",flex:1,defaults:{anchor:"100%"},cls:"cps-x-panel",items:[{xtype:"textfield",name:"ProduceControlLineId",fieldLabel:"模型编号",labelWidth:60,hidden:!0},{xtype:"numberfield",name:"RowId",fieldLabel:"行标识",labelWidth:60,value:0,minValue:0,step:1,hidden:!0},{xtype:"numberfield",name:"RowNo",fieldLabel:"行号",labelWidth:60,value:0,minValue:0,step:1,hidden:!0},{xtype:"textfield",name:"RelId",fieldLabel:"主数据ID",labelWidth:60,maxLength:20,maxLengthText:"此项最大输入长度为20",readOnly:!0},{xtype:"textfield",name:"ProgId",fieldLabel:"功能标识",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:50,maxLengthText:"此项最大输入长度为50",readOnly:!0},{xtype:"textfield",name:"ControlId",fieldLabel:"组件ID",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",listeners:{focus:function(t,n,o){e.originalValue=t.value},blur:function(t,n,o){if(e.originalValue)if(t.value){if(t.value.split("_")[0]!==e.originalValue.split("_")[0])Ext.Msg.alert("提示","当前组件ID必须以"+e.originalValue.split("_")[0]+"_为开头！"),this.up("form").getForm().findField("ControlId").setValue(e.originalValue);else if(t.value!==e.originalValue){var a=$(l.c.canvasId).find("div[id='"+t.value+"']");a.length>0?(Ext.Msg.alert("提示","当前组件ID已存在，请重新修改其值！"),this.up("form").getForm().findField("ControlId").setValue(e.originalValue)):($(l.c.canvasId).find("div[id='"+e.originalValue+"']").attr("id",t.value),e.setControlAttr(e.originalValue,"ControlId",t.value),s.a.updatePolylineIdByControlId(e.originalValue,t.value))}e.originalValue=null}else Ext.Msg.alert("提示","当前组件ID不可为空！"),this.up("form").getForm().findField("ControlId").setValue(e.originalValue)}}},{xtype:"textfield",name:"ControlName",fieldLabel:"组件别名",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",listeners:{focus:function(t,n,o){e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t,n,o){e.originalControlId&&(t.value?t.value!==e.originalValue&&($(l.c.canvasId).find("div[id='"+e.originalControlId+"']").find("div.cps-controls-span").text(t.value),e.setControlAttr(e.originalControlId,"ControlName",t.value)):(Ext.Msg.alert("提示","当前组件别名不可为空！"),this.up("form").getForm().findField("ControlName").setValue(e.originalValue),$(l.c.canvasId).find("div[id='"+e.originalControlId+"']").find("div.cps-controls-span").text(e.originalValue)),e.originalControlId=null)},change:function(t,n,o,a){e.originalControlId&&$(l.c.canvasId).find("div[id='"+e.originalControlId+"']").find("div.cps-controls-span").text(n)}}},{xtype:"fieldcontainer",fieldLabel:"组件类型",labelWidth:60,defaultType:"radiofield",defaults:{flex:1},layout:"vbox",items:[{boxLabel:"CPS组件",name:"ControlType",inputValue:"0",checked:!0,id:"radio0",readOnly:!0},{boxLabel:"系统组件",name:"ControlType",inputValue:"1",id:"radio1",readOnly:!0}]},{xtype:"numberfield",name:"XCoordinate",fieldLabel:"X坐标",labelWidth:60,value:1,minValue:1,step:1,allowBlank:!1,blankText:"此项必填",allowDecimals:!1,negativeText:"此项为整数值且大于0",listeners:{focus:function(t,n,o){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t,n,o){if(e.originalControlId){var a=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']");t.value&&t.value>0?t.value!==e.originalValue&&e.moveCpsControl(a,t.value,null):(Ext.Msg.alert("提示","当前X坐标不可为空且大于0！"),this.up("form").getForm().findField("XCoordinate").setValue(e.originalValue),a.css("left",e.originalValue)),e.originalControlId=null,d.a.setSizeDrawSvg()}},change:function(t,n,o,a){if(e.originalControlId){var r=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']");n>0?(r.css("left",n),d.a.resizeDrawSvg(r)):(this.up("form").getForm().findField("XCoordinate").setValue(1),r.css("left",1))}}}},{xtype:"numberfield",name:"YCoordinate",labelWidth:60,fieldLabel:"Y坐标",value:1,minValue:1,step:1,allowBlank:!1,blankText:"此项必填",allowDecimals:!1,negativeText:"此项为整数值且大于0",listeners:{focus:function(t,n,o){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t,n,o){if(e.originalControlId){var a=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']");t.value&&t.value>0?t.value!==e.originalValue&&e.moveCpsControl(a,null,t.value):(Ext.Msg.alert("提示","当前Y坐标不可为空且大于0！"),this.up("form").getForm().findField("YCoordinate").setValue(e.originalValue),a.css("top",e.originalValue)),e.originalControlId=null,d.a.setSizeDrawSvg()}},change:function(t,n,o,a){if(e.originalControlId){var r=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']");n>0?(r.css("top",n),d.a.resizeDrawSvg(r)):(this.up("form").getForm().findField("YCoordinate").setValue(1),r.css("top",1))}}}},{xtype:"numberfield",name:"ControlWidth",fieldLabel:"组件宽度",labelWidth:60,value:90,minValue:50,step:1,allowBlank:!1,blankText:"此项必填",allowDecimals:!1,negativeText:"此项为整数值且不得小于50",listeners:{focus:function(t,n,o){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t,n,o){if(e.originalControlId){var a=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']"),r=this.up("form").getForm().findField("ControlHeight").getValue();t.value&&t.value>=50?t.value!==e.originalValue&&(a.css("width",t.value),e.setControlAttr(e.originalControlId,"ControlWidth",t.value),s.a.updatePolylinePointsByControlId(e.originalControlId)):(Ext.Msg.alert("提示","当前组件宽度不可为空且不小于50！"),this.up("form").getForm().findField("ControlWidth").setValue(e.originalValue),a.css("width",e.originalValue),r>e.originalValue&&(r=e.originalValue),a.find("img").css({width:r-30+"px",height:r-30+"px"})),e.originalControlId=null,d.a.setSizeDrawSvg()}},change:function(t,n,o,a){if(e.originalControlId){var r=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']"),i=this.up("form").getForm().findField("ControlHeight").getValue();n<50?(n=50,this.up("form").getForm().findField("ControlWidth").setValue(50),r.css("width",n)):(r.css("width",n),d.a.resizeDrawSvg(r)),i>n&&(i=n),r.find("img").css({width:i-30+"px",height:i-30+"px"})}}}},{xtype:"numberfield",name:"ControlHeight",fieldLabel:"组件高度",labelWidth:60,value:60,minValue:40,step:1,allowBlank:!1,blankText:"此项必填",allowDecimals:!1,negativeText:"此项为整数值且不得小于40",listeners:{focus:function(t,n,o){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t,n,o){if(e.originalControlId){var a=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']"),r=this.up("form").getForm().findField("ControlWidth").getValue();t.value&&t.value>=40?t.value!==e.originalValue&&(a.css("height",t.value),e.setControlAttr(e.originalControlId,"ControlHeight",t.value),s.a.updatePolylinePointsByControlId(e.originalControlId)):(Ext.Msg.alert("提示","当前组件高度不可为空且不小于40！"),this.up("form").getForm().findField("ControlHeight").setValue(e.originalValue),a.css("height",e.originalValue),r>e.originalValue&&(r=e.originalValue),a.find("img").css({width:r-30+"px",height:r-30+"px"})),e.originalControlId=null,d.a.setSizeDrawSvg()}},change:function(t,n,o,a){if(e.originalControlId){var r=$(l.c.canvasId).find("div[id='"+e.originalControlId+"']"),i=this.up("form").getForm().findField("ControlWidth").getValue();n<40?(n=40,this.up("form").getForm().findField("ControlHeight").setValue(40),r.css("height",n)):(r.css("height",n),d.a.resizeDrawSvg(r)),i>n&&(i=n),r.find("img").css({width:i-30+"px",height:i-30+"px"})}}}},{xtype:"textareafield",name:"ControlDescription",height:200,fieldLabel:"组件描述",labelWidth:60,grow:!0,enforceMaxLength:!0,maxLength:2e3,maxLengthText:"此项最大输入长度为2000",listeners:{focus:function(t){e.originalControlId=this.up("form").getForm().findField("ControlId").getValue(),e.originalValue=t.value},blur:function(t){e.originalControlId&&(e.setControlAttr(e.originalControlId,"ControlDescription",t.value),e.originalControlId=null)}}}]}),l.b.controlsAttrPanel}},{key:"setControlAttrFormValues",value:function(t){var n=e.getControlAttr(t);l.b.controlsAttrPanel.getForm().setValues(n),Ext.getCmp("radio"+n.ControlType).setValue(!0),$(l.c.canvasId).find("div.cps-controls-region").css({"background-color":"#eceff4",border:"1px solid #bbcfde"}),t.find("div.cps-controls-region").css({"background-color":"#f7f8db",border:"1px solid #d2c06c"})}},{key:"getCpsControlMinWidthOrHeight",value:function(e,t,n,o,a,r){var i=0;return r?(i=t,i<50?i=50:o&&(e.css("left",o),l.b.controlsAttrPanel.getForm().findField("XCoordinate").setValue(o)),e.css("width",i),l.b.controlsAttrPanel.getForm().findField("ControlWidth").setValue(i),n>i&&(n=i),e.find("img").css({width:n-30+"px",height:n-30+"px"})):(i=n,i<40?i=40:a&&(e.css("top",a),l.b.controlsAttrPanel.getForm().findField("YCoordinate").setValue(a)),e.css("height",i),l.b.controlsAttrPanel.getForm().findField("ControlHeight").setValue(i),t>i&&(t=i),e.find("img").css({width:t-30+"px",height:t-30+"px"})),i}},{key:"changeCpsControlAttr",value:function(t,n){var o=n.width,a=n.height,r=n.left,i=n.top,l=event.clientX-parseInt(n.point.split(",")[0]),d=event.clientY-parseInt(n.point.split(",")[1]);if(1===n.index){var s=e.getCpsControlMinWidthOrHeight(t,o-l,a-d,r+l,null,!0);e.getCpsControlMinWidthOrHeight(t,s,a-d,null,i+d,!1)}else if(3===n.index){var c=e.getCpsControlMinWidthOrHeight(t,o+l,a-d,null,null,!0);e.getCpsControlMinWidthOrHeight(t,c,a-d,null,i+d,!1)}else if(5===n.index){var u=e.getCpsControlMinWidthOrHeight(t,o+l,a+d,null,null,!0);e.getCpsControlMinWidthOrHeight(t,u,a+d,null,null,!1)}else if(7===n.index){var p=e.getCpsControlMinWidthOrHeight(t,o-l,a+d,r+l,null,!0);e.getCpsControlMinWidthOrHeight(t,p,a+d,null,null,!1)}else 2===n.index?e.getCpsControlMinWidthOrHeight(t,o,a-d,null,i+d,!1):6===n.index?e.getCpsControlMinWidthOrHeight(t,o,a+d,null,null,!1):4===n.index?e.getCpsControlMinWidthOrHeight(t,o+l,a,null,null,!0):8===n.index&&e.getCpsControlMinWidthOrHeight(t,o-l,a,r+l,null,!0)}},{key:"zoomCpsControl",value:function(t,n){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});var o=t.attr("id"),a=Math.round(t.css("width").replace("px","")),r=Math.round(t.css("height").replace("px","")),i=n?1.2*a:a/1.2,c=i/a*r;i=e.getCpsControlMinWidthOrHeight(t,i,c,null,null,!0),e.setControlAttr(o,"ControlWidth",i),c=e.getCpsControlMinWidthOrHeight(t,i,c,null,null,!1),e.setControlAttr(o,"ControlHeight",c),s.a.updatePolylinePointsByControlId(o),d.a.resizeDrawSvg(t)}},{key:"moveCpsControl",value:function(t,n,o){var a=t.attr("id");o&&(t.css("top",o),e.setControlAttr(a,"YCoordinate",o),l.b.controlsAttrPanel.getForm().findField("YCoordinate").setValue(o)),n&&(t.css("left",n),e.setControlAttr(a,"XCoordinate",n),l.b.controlsAttrPanel.getForm().findField("XCoordinate").setValue(n)),s.a.updatePolylinePointsByControlId(a),d.a.resizeDrawSvg(t)}},{key:"getControlAttr",value:function(e){for(var t=e.attr("data-progid"),n=e.attr("id"),o=e.attr("data-relid"),a=e.find("div.cps-controls-span").text(),r=Math.round(e.css("left").replace("px","")),i=Math.round(e.css("top").replace("px","")),d=Math.round(e.css("width").replace("px","")),s=Math.round(e.css("height").replace("px","")),c=e.find("img").attr("src"),u={ProduceControlLineId:"",RowId:0,RowNo:0,ProgId:t,ControlId:n,ControlName:a,ControlDescription:a,ControlType:0,XCoordinate:r,YCoordinate:i,ControlWidth:d,ControlHeight:s,RelIcon:c,RelId:o},p=0;p<l.b.controlLineModels.ControlDetail.length;p++)if(l.b.controlLineModels.ControlDetail[p].ControlId===n){u.ProduceControlLineId=l.b.controlLineModels.ControlDetail[p].ProduceControlLineId,u.ControlDescription=l.b.controlLineModels.ControlDetail[p].ControlDescription,u.ControlType=l.b.controlLineModels.ControlDetail[p].ControlType;break}return u}},{key:"setControlAttr",value:function(e,t,n){for(var o=0;o<l.b.controlLineModels.ControlDetail.length;o++)if(l.b.controlLineModels.ControlDetail[o].ControlId===e){l.b.controlLineModels.ControlDetail[o][t]=n;break}}},{key:"setControlRelIdName",value:function(t,n,o,a){n=n.split("[")[0]+"["+a+"]",$(l.c.canvasId).find("div[id='"+t+"']").attr("data-relid",o),$(l.c.canvasId).find("div[id='"+t+"']").find("div.cps-controls-span").text(n),e.setControlAttr(t,"RelId",o),e.setControlAttr(t,"ControlName",n),l.b.controlsAttrPanel.getForm().findField("ControlId").getValue()===t&&(l.b.controlsAttrPanel.getForm().findField("RelId").setValue(o),l.b.controlsAttrPanel.getForm().findField("ControlName").setValue(n))}},{key:"updateControlByControlId",value:function(t,n){var o=$(l.c.canvasId).find("div[id='"+n+"']");if(o.length>0){var a=e.getControlAttr(o);if(t){for(var r=0;r<l.b.controlLineModels.ControlDetail.length;r++)if(l.b.controlLineModels.ControlDetail[r].ControlId===n){l.b.controlLineModels.ControlDetail.splice(r,1,a),s.a.updatePolylinePointsByControlId(n);break}}else l.b.controlLineModels.ControlDetail.push(a);d.a.setSizeDrawSvg()}}},{key:"deleteControlByControlId",value:function(e){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});for(var t=0;t<l.b.controlLineModels.ControlDetail.length;t++)if(l.b.controlLineModels.ControlDetail[t].ControlId===e){l.b.controlLineModels.ControlDetail.splice(t,1),s.a.deletePolylineByControlId(e);break}l.b.controlsAttrPanel.getForm().findField("ControlId").getValue()===e&&l.a.removeControlSelStyle(),$(l.c.canvasId).find("div[id='"+e+"']").remove(),d.a.setSizeDrawSvg()}}]),e}();c.originalValue=null,c.originalControlId=null},561:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=n(559),s=n(560),c=n(562),u=function(){function e(){a()(this,e)}return i()(e,null,[{key:"createPolylineAttrPanel",value:function(){return l.b.polylineAttrPanel=Ext.create("Ext.form.Panel",{id:"cpsPolylineAttr-panel",title:"矢量线属性",bodyPadding:5,width:"100%",height:170,flex:0,defaults:{anchor:"100%"},cls:"cps-x-panel",items:[{xtype:"textfield",name:"ProduceControlLineId",fieldLabel:"模型编号",labelWidth:60,hidden:!0},{xtype:"numberfield",name:"RowId",fieldLabel:"行标识",labelWidth:60,value:0,minValue:0,step:1,hidden:!0},{xtype:"numberfield",name:"RowNo",fieldLabel:"行号",labelWidth:60,value:0,minValue:0,step:1,hidden:!0},{xtype:"textfield",name:"StartControlId",fieldLabel:"起始组件",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",readOnly:!0},{xtype:"textfield",name:"EndControlId",fieldLabel:"结束组件",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",readOnly:!0},{xtype:"textfield",name:"LineId",fieldLabel:"矢量线ID",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",readOnly:!0},{xtype:"textfield",name:"Coordinates",fieldLabel:"矢量坐标",labelWidth:60,allowBlank:!1,blankText:"此项必填",enforceMaxLength:!0,maxLength:100,maxLengthText:"此项最大输入长度为100",readOnly:!0},{xtype:"fieldcontainer",fieldLabel:"起点类型",labelWidth:60,defaultType:"radiofield",defaults:{flex:1},layout:"hbox",items:[{boxLabel:"其他",name:"ControlStartType",inputValue:"0",checked:!0,id:"startRadio0",readOnly:!0},{boxLabel:"上",name:"ControlStartType",inputValue:"1",id:"startRadio1",readOnly:!0},{boxLabel:"右",name:"ControlStartType",inputValue:"2",id:"startRadio2",readOnly:!0},{boxLabel:"下",name:"ControlStartType",inputValue:"3",id:"startRadio3",readOnly:!0},{boxLabel:"左",name:"ControlStartType",inputValue:"4",id:"startRadio4",readOnly:!0}],hidden:!0},{xtype:"fieldcontainer",fieldLabel:"尾点类型",labelWidth:60,defaultType:"radiofield",defaults:{flex:1},layout:"hbox",items:[{boxLabel:"其他",name:"ControlEndType",inputValue:"0",checked:!0,id:"endRadio0",readOnly:!0},{boxLabel:"上",name:"ControlEndType",inputValue:"1",id:"endRadio1",readOnly:!0},{boxLabel:"右",name:"ControlEndType",inputValue:"2",id:"endRadio2",readOnly:!0},{boxLabel:"下",name:"ControlEndType",inputValue:"3",id:"endRadio3",readOnly:!0},{boxLabel:"左",name:"ControlEndType",inputValue:"4",id:"endRadio4",readOnly:!0}],hidden:!0}]}),l.b.polylineAttrPanel}},{key:"copySvgPolyline",value:function(t){for(var n=null,o=t.attr("points").split(" "),a=0;a<o.length;a++){n=n+(parseInt(o[a].split(",")[0])+10)+","+(parseInt(o[a].split(",")[1])+10)+" "}for(var r="drawLine_"+parseInt(1e4*Math.random());$(l.c.drawSVGId).find("line[id='"+r+"']").length>0;)r="drawLine_"+parseInt(1e4*Math.random());var i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i&&(i.setAttribute("name","drawLine"),i.setAttribute("id",r),i.setAttribute("marker-end","url(#markerArrow)"),i.setAttribute("style","fill:none;stroke:red;stroke-width:2;cursor:move"),i.setAttribute("data-endid",""),i.setAttribute("data-endtype","0"),i.setAttribute("data-startid",""),i.setAttribute("data-starttype","0"),i.setAttribute("points",n.substr(0,n.length-1)),$(l.c.drawSVGId).append(i),e.updatePolylineByLineId(r),e.setPolylineOtherEvent(),c.a.copySvgPolyline=$(i),d.a.setSizeDrawSvg())}},{key:"getPositionRectPoint",value:function(e,t){var n=l.b.positionRectPoints;if(n)for(var o=0;o<n.length;o++){var a=n[o],r=a.x,i=a.x+a.width,d=a.y,s=a.y+a.height;if(e<i&&e>r&&t<s&&t>d)return a}return null}},{key:"createPolyline",value:function(t,n){var o="",a=0,r=t-e.canvasOffsetX,i=n-e.canvasOffsetY,d=r+","+i,s=e.getPositionRectPoint(r,i);s&&(o=s.controlId,a=s.index,d=l.a.getPolylineStartOrEndPoint(s.x,s.y,s.index,!0));var u=c.a.createSvgPolyline(d,o,a,"",0);if(u){$(l.c.drawSVGId).append(u);var p=$(u).attr("id");e.setPolylineAttrFormValues(p),l.b.selVectorLineId=p}}},{key:"updatePolyline",value:function(t,n,o){var a=t.attr("points").split(" "),r=void 0,i=void 0,d=void 0,s=void 0;if(1===l.b.vectorLineIndex){r=parseInt(a[0].split(",")[0]),d=parseInt(a[0].split(",")[1]),i=n-e.canvasOffsetX,s=o-e.canvasOffsetY;var c=e.getPositionRectPoint(i,s);if(c){var u=l.a.getPolylineStartOrEndPoint(c.x,c.y,c.index,!1);i=parseInt(u.split(",")[0]),s=parseInt(u.split(",")[1]),t.attr({"data-endid":c.controlId,"data-endtype":c.index}),l.b.polylineAttrPanel.getForm().findField("EndControlId").setValue(c.controlId)}else t.attr({"data-endid":"","data-endtype":0}),l.b.polylineAttrPanel.getForm().findField("EndControlId").setValue("")}if(0===l.b.vectorLineIndex){var p=a.length-1;r=n-e.canvasOffsetX,d=o-e.canvasOffsetY,i=parseInt(a[p].split(",")[0]),s=parseInt(a[p].split(",")[1]);var f=e.getPositionRectPoint(r,d);if(f){var h=l.a.getPolylineStartOrEndPoint(f.x,f.y,f.index,!0);r=parseInt(h.split(",")[0]),d=parseInt(h.split(",")[1]),t.attr({"data-startid":f.controlId,"data-starttype":f.index}),l.b.polylineAttrPanel.getForm().findField("StartControlId").setValue(f.controlId)}else t.attr({"data-startid":"","data-starttype":0}),l.b.polylineAttrPanel.getForm().findField("StartControlId").setValue("")}var g=parseInt(t.attr("data-starttype")),m=parseInt(t.attr("data-endtype"));a=l.a.getPointsByStyle(r,d,i,s,g,m),t.attr({points:a}),l.b.polylineAttrPanel.getForm().findField("Coordinates").setValue(a)}},{key:"savePolyline",value:function(t){var n=t.attr("id"),o=t.attr("points").split(" ");if(o.length<2||o[0]===o[o.length-1])e.deletePolylineByLineId(n);else{var a=parseInt(o[0].split(",")[0]),r=parseInt(o[0].split(",")[1]),i=parseInt(o[o.length-1].split(",")[0]),d=parseInt(o[o.length-1].split(",")[1]);if(Math.abs(i-a)<4&&Math.abs(d-r)<4)e.deletePolylineByLineId(n);else{var s=e.getPolylineModel(t),c=l.a.checkProduceLineModel(s);c.length>0?(toastr.error(c[0].msg,"错误矢量线绘制"),e.deletePolylineByLineId(n)):(e.updatePolylineByLineId(n),e.setPolylineOtherEvent())}}}},{key:"setPolylineAttrFormValues",value:function(t){var n=$(l.c.drawSVGId).find("polyline[id='"+t+"']");if(n.length>0){var o=e.getPolylineModel(n);l.b.polylineAttrPanel.getForm().setValues(o),Ext.getCmp("startRadio"+o.ControlStartType).setValue(!0),Ext.getCmp("endRadio"+o.ControlEndType).setValue(!0)}}},{key:"getPolylineModel",value:function(e){var t=e.attr("id"),n=e.attr("data-startid"),o=e.attr("data-endid"),a=e.attr("points"),r=e.attr("data-starttype"),i=e.attr("data-endtype");return{ProduceControlLineId:"",RowId:0,RowNo:0,StartControlId:n,EndControlId:o,LineId:t,Coordinates:a,ControlStartType:parseInt(r),ControlEndType:parseInt(i)}}},{key:"updatePolylineByLineId",value:function(t){for(var n=$(l.c.drawSVGId).find("polyline[id='"+t+"']"),o=e.getPolylineModel(n),a=0;a<l.b.controlLineModels.VectorLineDetail.length;a++)if(l.b.controlLineModels.VectorLineDetail[a].LineId===t){l.b.controlLineModels.VectorLineDetail.splice(a,1);break}l.b.controlLineModels.VectorLineDetail.push(o)}},{key:"updatePolylineIdByControlId",value:function(e,t){if(l.b.polylineAttrPanel.getForm().findField("LineId").getValue()){var n=l.b.polylineAttrPanel.getForm().findField("StartControlId").getValue(),o=l.b.polylineAttrPanel.getForm().findField("EndControlId").getValue();n===e&&l.b.polylineAttrPanel.getForm().findField("StartControlId").setValue(t),o===e&&l.b.polylineAttrPanel.getForm().findField("EndControlId").setValue(t)}for(var a=0;a<l.b.controlLineModels.VectorLineDetail.length;a++){var r=l.b.controlLineModels.VectorLineDetail[a];r.StartControlId===e&&(r.StartControlId=t,$(l.c.drawSVGId).find("polyline[id='"+r.LineId+"']").attr({"data-startid":t})),r.EndControlId===e&&(r.EndControlId=t,$(l.c.drawSVGId).find("polyline[id='"+r.LineId+"']").attr({"data-endid":t}))}}},{key:"updatePolylinePointsByControlId",value:function(e){var t=$(l.c.drawSVGId).find("polyline[data-startid='"+e+"']"),n=$(l.c.drawSVGId).find("polyline[data-endid='"+e+"']");if(t.length>0||n.length>0)for(var o=$(l.c.canvasId).find("div[id='"+e+"']"),a=l.a.getElementPoints(o,"controlRect"),r=0;r<l.b.controlLineModels.VectorLineDetail.length;r++){var i=l.b.controlLineModels.VectorLineDetail[r];if(i.StartControlId===e||i.EndControlId===e){var d=i.ControlStartType,s=i.ControlEndType,c=i.Coordinates.split(" "),u=parseInt(c[0].split(",")[0]),p=parseInt(c[0].split(",")[1]),f=parseInt(c[c.length-1].split(",")[0]),h=parseInt(c[c.length-1].split(",")[1]);if(i.StartControlId===e){u=a[d-1].x,p=a[d-1].y;var g=l.a.getPolylineStartOrEndPoint(u,p,d,!0);g&&(u=parseInt(g.split(",")[0]),p=parseInt(g.split(",")[1]))}else if(i.EndControlId===e){f=a[s-1].x,h=a[s-1].y;var m=l.a.getPolylineStartOrEndPoint(f,h,s,!1);m&&(f=parseInt(m.split(",")[0]),h=parseInt(m.split(",")[1]))}var v=l.a.getPointsByStyle(u,p,f,h,d,s);$(l.c.drawSVGId).find("polyline[id='"+i.LineId+"']").attr({points:v}),i.Coordinates=v}}}},{key:"deletePolylineByControlId",value:function(e){for(var t=[],n=0;n<l.b.controlLineModels.VectorLineDetail.length;n++){var o=l.b.controlLineModels.VectorLineDetail[n];o.StartControlId!==e&&o.EndControlId!==e?t.push(o):$(l.c.drawSVGId).find("polyline[id='"+o.LineId+"']").remove()}l.b.controlLineModels.VectorLineDetail=t,l.b.polylineAttrPanel.getForm().reset()}},{key:"deletePolylineByLineId",value:function(e){$(l.c.drawSVGId).find("circle[name='drawCircle']").css({display:"none"});for(var t=0;t<l.b.controlLineModels.VectorLineDetail.length;t++)if(l.b.controlLineModels.VectorLineDetail[t].LineId===e){l.b.controlLineModels.VectorLineDetail.splice(t,1);break}l.b.polylineAttrPanel.getForm().findField("LineId").getValue()===e&&l.b.polylineAttrPanel.getForm().reset(),$(l.c.drawSVGId).find("polyline[id='"+e+"']").remove(),d.a.setSizeDrawSvg()}},{key:"initPolylineEvent",value:function(){e.setPolylineOtherEvent(),e.setPolylineDrawEvent()}},{key:"setPolylineOtherEvent",value:function(){$(l.c.drawSVGId).find("polyline[name='drawLine']").unbind("click").bind("click",function(t){l.b.useVectorLine||(l.b.selSvgPolyline=$(this),l.b.isSelCpsControl=!1,l.b.selVectorLineId=l.b.selSvgPolyline.attr("id"),l.a.showElementPoints(l.b.selSvgPolyline,"drawCircle"),e.setPolylineAttrFormValues(l.b.selVectorLineId))})}},{key:"setPolylineDrawEvent",value:function(){$(l.c.canvasId).unbind("mousedown").bind("mousedown",function(t){l.b.useVectorLine&&!l.b.selVectorLineId&&(e.canvasOffsetX=$(l.c.canvasId).offset().left-$(l.c.canvasId).scrollLeft(),e.canvasOffsetY=$(l.c.canvasId).offset().top-$(l.c.canvasId).scrollTop(),e.createPolyline(t.clientX,t.clientY),t.preventDefault())}),$(l.c.canvasId).unbind("mousemove").bind("mousemove",function(t){if((l.b.useVectorLine||l.b.redrawVectorLine)&&l.b.selVectorLineId){var n=$(l.c.drawSVGId).find("polyline[id='"+l.b.selVectorLineId+"']");n.length>0&&(e.canvasOffsetX=$(l.c.canvasId).offset().left-$(l.c.canvasId).scrollLeft(),e.canvasOffsetY=$(l.c.canvasId).offset().top-$(l.c.canvasId).scrollTop(),e.updatePolyline(n,t.clientX,t.clientY))}if(!l.b.useVectorLine&&l.b.redrawCpsControl&&l.b.selControlId){var o=$(l.c.canvasId).find("div[id='"+l.b.selControlId+"']");o.length>0&&(s.a.changeCpsControlAttr(o,l.b.cpsControlPoint),d.a.resizeDrawSvg(o))}}),$(l.c.canvasId).unbind("mouseup").bind("mouseup",function(t){if((l.b.useVectorLine||l.b.redrawVectorLine)&&l.b.selVectorLineId){var n=$(l.c.drawSVGId).find("polyline[id='"+l.b.selVectorLineId+"']");n.length>0&&(l.a.showElementPoints(n,"drawCircle"),e.savePolyline(n)),l.b.selVectorLineId=null,l.b.redrawVectorLine=!1,l.b.vectorLineIndex=1,$(l.c.drawSVGId).find("rect[name='controlRect']").css({display:"none"}),l.b.positionRectPoints=null,d.a.setSizeDrawSvg()}else l.b.selVectorLineId=null,$(l.c.drawSVGId).find("circle[name='drawCircle']").css({display:"none"}),l.b.polylineAttrPanel.getForm().reset();if(!l.b.useVectorLine&&l.b.redrawCpsControl&&l.b.selControlId){l.b.redrawCpsControl=!1,l.b.cpsControlPoint=null;var o=$(l.c.canvasId).find("div[id='"+l.b.selControlId+"']");l.a.showElementPoints(o,"zoomCircle");var a=Math.round(o.css("width").replace("px",""));s.a.setControlAttr(l.b.selControlId,"ControlWidth",a);var r=Math.round(o.css("height").replace("px",""));s.a.setControlAttr(l.b.selControlId,"ControlHeight",r),e.updatePolylinePointsByControlId(l.b.selControlId),d.a.setSizeDrawSvg()}else l.b.selControlId=null,$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"})})}}]),e}();u.canvasOffsetX=0,u.canvasOffsetY=0},562:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=n(559),s=n(567),c=n(570),u=n(561),p=n(560),f=function(){function e(){a()(this,e)}return i()(e,null,[{key:"reInitCpsConfigureView",value:function(){l.b.controlLineModels={ProduceControlLineId:"",ProduceControlLineName:"",ControlConfigId:"",FactoryModuleType:0,State:0,ControlDetail:[],VectorLineDetail:[]},l.b.masterVcl=null,l.b.selControlId=null,l.b.selVectorLineId=null,l.b.vectorLineIndex=1,e.isShowTaskNoTip=!0,e.sysEventPanel.items.getAt(5).setText("开启动态展示"),$("#pointerTool").click(),$("#descriptionBox").attr("data-checked")&&$("#descriptionBox").click(),d.a.selFactoryModuleType(void 0,null)}},{key:"getProduceLineOfWorkStation",value:function(e,t){var n=$(l.c.canvasId).find("div[data-progid='com.Workstation'][data-relid='"+t+"']");if(n&&n.length>0)for(var o=0;o<n.length;o++){var a=$(n[o]).attr("id"),r=$(l.c.drawSVGId).find("polyline[data-startid='"+a+"'][data-endid^='"+l.c.comWorkProcess+"']").attr("data-endid"),i=$(l.c.drawSVGId).find("polyline[data-startid='"+r+"'][data-endid^='"+l.c.comWorkshopSection+"']").attr("data-endid"),d=$(l.c.drawSVGId).find("polyline[data-startid='"+i+"'][data-endid^='"+l.c.comProduceLine+"']").attr("data-endid"),s=$(l.c.canvasId).find("div[id='"+d+"']").attr("data-relid");if(e===s)return $(n[o])}return null}},{key:"createSvg",value:function(e,t,n){var o=document.createElementNS("http://www.w3.org/2000/svg","svg");if(o){var a=e.attr("id")+"-tip",r=Math.round(e.css("left").replace("px","")),i=Math.round(e.css("top").replace("px","")),l=Math.round(e.css("width").replace("px",""));if(o.setAttribute("id",a),o.setAttribute("name","wsTip"),t){var d=r-30,s=n?i-55:i-120;o.setAttribute("x",d),o.setAttribute("y",s)}else{var c=r+l-5,u=i;o.setAttribute("x",c),o.setAttribute("y",u)}o.setAttribute("preserveAspectRatio","xMidYMin meet"),o.setAttribute("style","fill: none;fill-opacity: 1;")}return o}},{key:"createSvgPolyline",value:function(e,t,n,o,a){var r=document.createElementNS("http://www.w3.org/2000/svg","polyline");if(r){for(var i="drawLine_"+parseInt(1e4*Math.random());$(l.c.drawSVGId).find("line[id='"+i+"']").length>0;)i="drawLine_"+parseInt(1e4*Math.random());r.setAttribute("name","drawLine"),r.setAttribute("id",i),r.setAttribute("marker-end","url(#markerArrow)"),r.setAttribute("style","fill:none;stroke:red;stroke-width:2;cursor:move"),r.setAttribute("data-startid",t),r.setAttribute("data-starttype",n),r.setAttribute("data-endid",o),r.setAttribute("data-endtype",a),r.setAttribute("points",e)}return r}},{key:"createSvgRect",value:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");if(n){var o=e?1:t?15:150;n.setAttribute("x",o),n.setAttribute("y","0"),n.setAttribute("rx","6"),n.setAttribute("ry","6"),n.setAttribute("width","130"),n.setAttribute("height","50"),n.setAttribute("style","fill:#f7f8db;stroke:rgba(136, 136, 136, 0.5);stroke-width:3;")}return n}},{key:"createSvgPolygon",value:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","polygon");if(n){if(e){var o=t?"45,45 53,65 61,45":"60,45 68,130 76,45";n.setAttribute("points",o)}else{var a=t?"18,15 0,23 18,31":"153,20 0,28 153,36";n.setAttribute("points",a)}n.setAttribute("style","fill: #f7f8db;")}return n}},{key:"createSvgText",value:function(t,n,o,a,r){var i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i){var l=a?5:r?20:155;i.setAttribute("x",l),i.setAttribute("y",t),i.setAttribute("style","font-size: 10px;fill: black;");var d=document.createTextNode(n+":");i.appendChild(d);var s=e.createSvgTSpan(t,o,a,r);i.appendChild(s)}return i}},{key:"createSvgTSpan",value:function(e,t,n,o){var a=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(a){var r=n?50:o?65:200;a.setAttribute("x",r),a.setAttribute("y",e),a.setAttribute("style","font-size: 10px;fill: black;font-weight: bold;");var i=document.createTextNode(t);a.appendChild(i)}return a}},{key:"createWorkStationSvgTip",value:function(t,n,o,a){var r=e.getProduceLineOfWorkStation(t,n.WorkStationId);if(r){var i=0===n.State?"空闲":"被占用",d=e.createSvg(r,a,o),s=e.createSvgRect(a,o);d.appendChild(s);var c=e.createSvgPolygon(a,o);d.appendChild(c);var u=e.createSvgText("15","站点状态",i,a,o);d.appendChild(u);var p=e.createSvgText("30","派工单号",n.TaskNo,a,o);d.appendChild(p);var f=e.createSvgText("45","已完成数",n.FinishCount,a,o);d.appendChild(f),$(l.c.drawSVGId).append(d)}}},{key:"setProduceLineOfWorkStationTips",value:function(t){for(var n=0;n<t.length;n++)for(var o=t[n],a=o.ProduceLineId,r=$(l.c.canvasId).find("div[data-progid='com.ProduceLine'][data-relid='"+a+"']"),i=Math.round(r.css("width").replace("px","")),d=Math.round(r.css("height").replace("px","")),s=i>d-30,c=0;c<o.WorkstationDetail.length;c++){var u=o.WorkstationDetail[c],p=c%2==0;e.createWorkStationSvgTip(a,u,p,s)}}},{key:"showProduceLineOfWorkStationInfo",value:function(){Ext.Ajax.request({url:"/CpsModule/GetProduceLineOfStationInfo",jsonData:{info:l.b.controlLineModels},method:"POST",async:!1,timeout:9e7,success:function(t){var n=Ext.decode(t.responseText);if(n.Messages.length>0){for(var o=[],a=0;a<n.Messages.length;a++)o.push({kind:n.Messages[a].MessageKind,msg:n.Messages[a].Message});Ax.utils.LibMsg.show(o)}else n.Result.length>0?(e.destroyWorkStationTips(),e.setProduceLineOfWorkStationTips(n.Result),e.isShowTaskNoTip=!1,e.sysEventPanel.items.getAt(5).setText("关闭动态展示")):Ext.Msg.alert("提示","当前产线的站点未进行任何指令操作！")},failure:function(e){Ext.Msg.alert("提示","当前产线的站点动态数据展示失败")}})}},{key:"destroyWorkStationTips",value:function(){$(l.c.drawSVGId).find("svg[name='wsTip']").remove(),l.a.removeControlSelStyle(),e.isShowTaskNoTip=!0,e.sysEventPanel.items.getAt(5).setText("开启动态展示")}},{key:"createEventPanel",value:function(){return e.sysEventPanel=Ext.create("Ext.panel.Panel",{id:"cpsEvent-panel",bodyPadding:5,layout:{type:"table",columns:6},defaults:{margin:"0 5 0 5"},items:[{xtype:"button",text:"初始化",scale:"medium",colspan:1,handler:function(){Ext.Msg.confirm("系统提示","这将会清空画板，确认继续吗？",function(t){"yes"===t&&e.reInitCpsConfigureView()})}},{xtype:"button",text:"保存",scale:"medium",colspan:1,handler:function(){var e=l.a.checkProduceControlLineModels();e.length<1?Ext.Msg.prompt("请输入CPS建模名称","名称",function(e,t){"ok"===e&&(t?(l.b.controlLineModels.ProduceControlLineName=t,$("#cpsLoading").css("display","block"),l.a.saveProduceControlLineModels(),$("#cpsLoading").css("display","none")):Ext.Msg.alert("提示","CPS建模名称不能为空!"))},this,!1,l.b.controlLineModels.ProduceControlLineName):Ax.utils.LibMsg.show(e)}},{xtype:"button",text:"预览",scale:"medium",colspan:1,handler:function(){d.a.showProduceControlLineModels()}},{xtype:"button",text:"纠察",scale:"medium",colspan:1,handler:function(){var e=l.a.checkProduceControlLineModels();e.length<1?Ext.Msg.alert("提示","已为您纠察完毕。"):Ax.utils.LibMsg.show(e)}},{xtype:"button",text:"隐藏属性模块",scale:"medium",colspan:1,handler:function(){e.showAttrFormPanel?(e.showAttrFormPanel=!1,this.up("panel").items.getAt(4).setText("显示属性模块")):(e.showAttrFormPanel=!0,this.up("panel").items.getAt(4).setText("隐藏属性模块")),l.b.attrFormPanels.setVisible(e.showAttrFormPanel)}},{xtype:"button",text:"开启动态展示",scale:"medium",colspan:1,handler:function(){if(e.isShowTaskNoTip){var t=l.a.checkProduceControlLineModels();t.length<1?e.taskNoTipInterval=window.setInterval(e.showProduceLineOfWorkStationInfo,3e3):Ax.utils.LibMsg.show(t)}else e.destroyWorkStationTips(),window.clearInterval(e.taskNoTipInterval)}}]}),e.sysEventPanel}},{key:"initCommonEvent",value:function(){$(l.b.renderTo).unbind("contextmenu").bind("contextmenu",function(e){return e.originalEvent.preventDefault(),!1}),$(l.b.renderTo).unbind("mouseup").bind("mouseup",function(e){l.b.useVectorLine||1!==e.button&&0!==e.button||l.b.munePanel&&l.b.munePanel.hide()}),$(l.c.controlsId).find("div[name='cpsControlTitle']").unbind("click").bind("click",function(e){"block"===$(this).parent().find("div[name='cpsControls']").css("display")?($(this).find("img[name='cpsImage']").removeClass("cps-controls-openimg"),$(this).parent().find("div[name='cpsControls']").css("display","none")):($(this).find("img[name='cpsImage']").addClass("cps-controls-openimg"),$(this).parent().find("div[name='cpsControls']").css("display","block"))}),$(l.c.canvasId).unbind("keydown").bind("keydown",function(t){if(!l.b.useVectorLine&&(("Delete"===t.key||46===t.keyCode||46===t.which||t.ctrlKey&&("d"===t.key||68===t.keyCode||68===t.which))&&(l.b.selVectorLineId&&(u.a.deletePolylineByLineId(l.b.selVectorLineId),l.b.selVectorLineId=null),l.b.selControlId&&(p.a.deleteControlByControlId(l.b.selControlId),l.b.selControlId=null)),t.ctrlKey)){if("c"!==t.key&&67!==t.keyCode&&67!==t.which||(l.b.isSelCpsControl?(e.copyCpsControl=l.b.selCpsControl,e.isPasteCpsControl=!0):(e.copySvgPolyline=l.b.selSvgPolyline,e.isPasteCpsControl=!1)),"v"!==t.key&&86!==t.keyCode&&86!==t.which||(e.copyCpsControl&&e.isPasteCpsControl&&c.a.copyCpsControl(e.copyCpsControl),e.copySvgPolyline&&!e.isPasteCpsControl&&u.a.copySvgPolyline(e.copySvgPolyline)),!l.b.selCpsControl||"+"!==t.key&&107!==t.keyCode&&107!==t.which||p.a.zoomCpsControl(l.b.selCpsControl,!0),!l.b.selCpsControl||"-"!==t.key&&109!==t.keyCode&&109!==t.which||p.a.zoomCpsControl(l.b.selCpsControl,!1),l.b.selCpsControl&&("ArrowUp"===t.key||38===t.keyCode||38===t.which)){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});var n=Math.round(l.b.selCpsControl.css("top").replace("px",""));n=n>1?n-1:1,p.a.moveCpsControl(l.b.selCpsControl,null,n)}if(l.b.selCpsControl&&("ArrowDown"===t.key||40===t.keyCode||40===t.which)){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});var o=Math.round(l.b.selCpsControl.css("top").replace("px",""))+1;p.a.moveCpsControl(l.b.selCpsControl,null,o)}if(l.b.selCpsControl&&("ArrowLeft"===t.key||37===t.keyCode||37===t.which)){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});var a=Math.round(l.b.selCpsControl.css("left").replace("px",""));a=a>1?a-1:1,p.a.moveCpsControl(l.b.selCpsControl,a,null)}if(l.b.selCpsControl&&("ArrowRight"===t.key||39===t.keyCode||39===t.which)){$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"});var r=Math.round(l.b.selCpsControl.css("left").replace("px",""))+1;p.a.moveCpsControl(l.b.selCpsControl,r,null)}}t.originalEvent.preventDefault()}),$(l.c.drawSVGId).find("circle[name='zoomCircle']").unbind("mousedown").bind("mousedown",function(e){if(!l.b.useVectorLine&&!l.b.redrawCpsControl){var t=$(this).attr("data-controlid"),n=parseInt($(this).attr("data-index")),o=$(l.c.canvasId).find("div[id='"+t+"']"),a=Math.round(o.css("width").replace("px","")),r=Math.round(o.css("height").replace("px","")),i=Math.round(o.css("left").replace("px","")),d=Math.round(o.css("top").replace("px",""));$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),l.b.selControlId=t,l.b.cpsControlPoint={point:e.clientX+","+e.clientY,width:a,height:r,left:i,top:d,index:n},l.b.redrawCpsControl=!0,c.a.dragControl=null}}),$(l.c.drawSVGId).find("circle[name='drawCircle']").unbind("mousedown").bind("mousedown",function(e){var t=$(this).attr("data-lineid"),n=parseInt($(this).attr("data-index"));$(l.c.drawSVGId).find("circle[id='drawCircle"+n+"']").css({display:"none"}),l.b.selVectorLineId=t,l.b.vectorLineIndex=n,l.b.redrawVectorLine=!0})}},{key:"loadCpsConfigureEvent",value:function(){s.a.initSystemControlEvent(),e.initCommonEvent(),c.a.initProgramControlEvent(),u.a.initPolylineEvent()}}]),e}();f.sysEventPanel=!0,f.showAttrFormPanel=!0,f.taskNoTipInterval=null,f.isShowTaskNoTip=!0,f.copyCpsControl=null,f.copySvgPolyline=null,f.isPasteCpsControl=!0},563:function(e,t){t.f={}.propertyIsEnumerable},564:function(e,t,n){var o=n(38),a=n(31),r=n(230),i=n(565),l=n(32).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=r?{}:o.Symbol||{});"_"==e.charAt(0)||e in t||l(t,e,{value:i.f(e)})}},565:function(e,t,n){t.f=n(27)},567:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=function(){function e(){a()(this,e)}return i()(e,null,[{key:"loadControlConfigVue",value:function(e,t){var n="";if(e&&e.ConfigDetail.length>0){var o=0===e.DisplayType?180:1===e.DisplayType?90:60,a=0===e.DisplayType?120:1===e.DisplayType?60:40,r=e.DisplayType+1,i=0;n='<table cellspacing="5" border="0"><tbody>';for(var d=0;d<e.ConfigDetail.length;d++){var s=e.ConfigDetail[d];0===i&&(n+="<tr>"),n+="<td>",n=t?n+'<div class="cps-controls-td" name="cpsIcon" style="width:'+o+"px;height:"+a+'px;"  draggable="true" id="'+s.ProgId.replace(".","")+'"  data-relid="" data-progid="'+s.ProgId+'">':n+'<div class="cps-controls-td" name="sysIcon" style="width:'+o+"px;height:"+a+'px;" id="'+s.ProgId.replace(".","")+'"  data-checked="" data-progid="'+s.ProgId+'">',n+='<div class="cps-controls-region">',n=n+'<img src="'+s.RelIcon+'" style="width: '+(a-30)+"px;height:"+(a-30)+'px;"/>',n=n+'<div class="cps-controls-span">'+s.ProgName+"</div>",n+="</div>",n+="</div>",n+="</td>",i++,i===r&&(n+="</tr>",i=0)}0!==i&&(i=r-i,n=n+'<td colspan="'+i+'"></td>',n+="</tr>"),n+="</tbody></table>"}t?$(l.c.cpsControlsId).empty().append(n):$(l.c.sysControlsId).empty().append(n)}},{key:"loadSystemControlConfigVue",value:function(){var t={ControlConfigId:"1",ControlConfigName:"",FactoryModuleType:0,DisplayType:1,ConfigDetail:[{ControlConfigId:"1",RowId:1,RowNo:1,ProgId:"pointerTool",ProgName:"指针工具",RelIcon:"/Scripts/img/cps/指针工具.png",ControlType:1},{ControlConfigId:"1",RowId:2,RowNo:2,ProgId:"vectorLine",ProgName:"矢量线",RelIcon:"/Scripts/img/cps/矢量线.png",ControlType:1},{ControlConfigId:"1",RowId:3,RowNo:3,ProgId:"descriptionBox",ProgName:"描述框",RelIcon:"/Scripts/img/cps/描述框.png",ControlType:1},{ControlConfigId:"1",RowId:4,RowNo:4,ProgId:"comboBox",ProgName:"组合框",RelIcon:"/Scripts/img/cps/组合框.png",ControlType:1}]};e.loadControlConfigVue(t,!1),$("#pointerTool").find("div.cps-controls-region").css({"background-color":"#f7f8db",border:"1px solid #d2c06c "})}},{key:"initSystemControlEvent",value:function(){$("#descriptionBox").unbind("click").bind("click",function(e){$(this).attr("data-checked")?($(this).attr("data-checked",""),$("#descriptionBox").find("div.cps-controls-region").css({"background-color":"#ffffff",border:"0"}),l.b.useToolTip=!1):($(this).attr("data-checked","true"),$("#descriptionBox").find("div.cps-controls-region").css({"background-color":"#f7f8db",border:"1px solid #d2c06c"}),l.b.useToolTip=!0)}),$("#pointerTool").unbind("click").bind("click",function(e){$("#pointerTool").find("div.cps-controls-region").css({"background-color":"#f7f8db",border:"1px solid #d2c06c "}),$("#vectorLine").find("div.cps-controls-region").css({"background-color":"#ffffff",border:"0"}),$(l.c.drawSVGId).css({cursor:"default"}),$(l.c.drawSVGId).find("rect[name='controlRect']").css({display:"none"}),$(l.c.drawSVGId).find("circle[name='drawCircle']").css({display:"none"}),l.b.useVectorLine=!1}),$("#vectorLine").unbind("click").bind("click",function(e){$("#pointerTool").find("div.cps-controls-region").css({"background-color":"#ffffff",border:"0"}),$("#vectorLine").find("div.cps-controls-region").css({"background-color":"#f7f8db",border:"1px solid #d2c06c "}),$(l.c.drawSVGId).css({cursor:"crosshair"}),$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),l.b.useVectorLine=!0})}}]),e}()},568:function(e,t,n){var o=n(234),a=n(147).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,a)}},569:function(e,t){t.f=Object.getOwnPropertySymbols},570:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(558),d=n(559),s=n(560),c=n(562),u=function(){function e(){a()(this,e)}return i()(e,null,[{key:"getBillDataList",value:function(e,t,n,o,a,r){var i=[],l=0,d=e(),s=t.getValue();"all"===s&&(s=""),Ext.Ajax.request({url:"/billSvc/getBillListing",method:"POST",jsonData:{listingQuery:{Handle:UserHandle,ProgId:o.PROGID,TimeFilter:n.getValue(),Filter:d,EntryParam:o.ENTRYPARAM}},async:!1,timeout:9e7,success:function(e){var n=Ext.decode(e.responseText),o=Ext.decode(n.GetBillListingResult),d=Ext.decode(o.FilterField);d.length>0&&t.store.loadData(d,!0);var s=o.Data.length;if(s>=a)for(var c=0;c<a;c++)i.push(o.Data[c]);else i=o.Data;l=Math.ceil(s/a),r(!0,o,i,l)},failure:function(e){Ext.Msg.alert("提示","获取此功能数据列表失败"),r(!1,[],[],0)}})}},{key:"showProgramDataListView",value:function(t,n,o){if($("#cpsLoading").css("display","block"),n)if(l.a.canUseFunc(n)){var a=null,r="Ext_"+l.a.randomString(),i={parentId:r,MENUITEM:t,PROGID:n,PROGNAME:t,BILLTYPE:0,ENTRYPARAM:"",ISVISUAL:!1,CONDITION:"",id:r,leaf:!0,children:null},d=n.replace(".","")+"panel",s=l.a.getFilterCob(),c=l.a.getCompareCbo(),u=l.a.getCompareTxt(),p=l.a.getDateCbo(),f=Ax.utils.LibQuickSelectBuilder.createSelectBar(i.BILLTYPE),h=f[0],g=[],m=[],v=0,y=[];e.getBillDataList(f[1],s,p,i,200,function(n,r,C,b){if(n){g=r,m=C,v=b;var I=Ext.create("Ext.data.Store",{fields:Ext.decode(g.Fields),proxy:{type:"memory",reader:{type:"json"}},data:m}),x=$(l.b.renderTo).height(),E=Ext.create("Ext.grid.Panel",{height:x-90,pageCount:1,pageSize:200,flex:1,store:I,autoScroll:!0,Pks:g.Pk,selType:"checkboxmodel",multiSelect:!1,columns:Ext.decode(g.Columns),plugins:"gridfilters",listeners:{itemclick:function(e,t,n,o,a,r){document.body.clientWidth<1210&&y[2].execute()},itemdblclick:function(e,t,n,o,a,r){document.body.clientWidth>=1210&&y[2].execute()}}});E.columns[0].renderer=function(e,t,n,o){return(E.pageCount-1)*E.pageSize+o+1},y=Ax.utils.LibToolBarBuilder.createBillListingAction(i.PROGID,i.BILLTYPE,t,0,E,s,c,u,p,f[1],void 0,i.ENTRYPARAM,b,200,v,g);var w=Ext.create(Ext.Action,{text:"选择确认",iconCls:"fa fa-check ",handler:function(){var e=E.getView().getSelectionModel().getSelection();if(1===e.length){var t=E.Pks[0],n=e[0].get(t),r=t.substr(0,t.length-2)+"NAME",i=e[0].get(r);a&&a.close(),o(n,i)}else Ext.Msg.alert("提示","只能选择一行数据")}});y.push(w);var S=Ext.create("Ext.panel.Panel",{id:d,layout:{type:"vbox",align:"stretch"},border:!1,tbar:Ax.utils.LibToolBarBuilder.createToolBar(y),toolBarAction:y,items:[E,h]}),M=.8*document.body.clientWidth,L=.9*document.body.clientHeight-20;a=Ext.create("Ext.window.Window",{title:t,titleAlign:"center",constrain:!0,closable:!0,draggable:!0,resizable:!1,width:M,height:L,border:!1,layout:"fit",items:S,isWindow:!0,listeners:{beforeshow:function(t,n){if(E.getView().getSelectionModel().clearSelections(),E.getView().refresh(),e.menuControlRelId)for(var o=E.Pks[0],a=E.getView().getStore(),r=a.getCount(),i=0;i<r;i++)if(a.getAt(i).get(o)===e.menuControlRelId)return void E.getView().getSelectionModel().selectRange(i,i,!0)}}}),a.show()}})}else Ext.Msg.alert("提示","没有当前功能的使用权限。");$("#cpsLoading").css("display","none")}},{key:"AdditionalTechRouteData",value:function(t,n,o,a){Ext.Ajax.request({url:"/CpsModule/GetCurrentTechRouteInfo",jsonData:{techRouteId:a,techRouteControlId:n,info:l.b.controlLineModels},method:"POST",async:!1,timeout:9e7,success:function(r){var i=void 0;r.responseText&&(i=Ext.decode(r.responseText));var l=a?BillActionEnum.Edit:BillActionEnum.AddNew,s=a?[a]:void 0;e.showProgramDataView(t,l,s,null,i,function(e,t){d.a.buildControlLayout(n,o,e,t,!1)})},failure:function(e){a?Ext.Msg.alert("提示","修改当前标准工艺路线["+a+"]数据出现异常"):Ext.Msg.alert("提示","新增当前标准工艺路线["+a+"]数据出现异常")}})}},{key:"showProgramDataView",value:function(e,t,n,o,a,r){$("#cpsLoading").css("display","block");var i=Ax.utils.LibVclSystemUtils.getVcl(e,BillTypeEnum.Master),l=Ax.utils.LibVclSystemUtils.getView(e,BillTypeEnum.Master,i);i.entryParam=o,i.getTpl(),i.billType=BillTypeEnum.Master;var s=Ext.id();DesktopApp.ActiveWindow=s,i.winId=s;var c=l[i.funcView.get("default").name](t,n,!0);if(c){var u=i.tpl.DisplayText,p=i.dataSet.getTable(0).data.items[0],f=Ax.utils.LibVclSystemUtils.getCurrentStateText(p.get("CURRENTSTATE")),h="";if(void 0!==n&&(h=n[0]),i.tpl.ShowAuditState){f=h+u+"【"+f+"】【"+Ax.utils.LibVclSystemUtils.getAuditStateText(p.get("AUDITSTATE"),p.get("FLOWLEVEL"))+"】"}else f=h+u+"【"+f+"】";i.billType===BillTypeEnum.Master&&(p.get("ISVALIDITY")||(f+="【已失效】"));var g=Ext.create("Ext.window.Window",{id:s,title:f,progName:u,autoScroll:!0,width:.8*document.body.clientWidth,height:.9*document.body.clientHeight,constrainHeader:!0,minimizable:!0,maximizable:!0,items:c,vcl:i,listeners:{close:function(e,t){if(this.vcl.vclHandler(e,{libEventType:LibEventTypeEnum.FormClosed}),2===e.vcl.dataSet.getTable(0).data.items[0].get("CURRENTSTATE")&&!e.vcl.isEdit){var n=e.vcl.dataSet.getTable(0).data.items[0].store.Pks[0],o=e.vcl.dataSet.getTable(0).data.items[0].get(n),a=n.substr(0,n.length-2)+"NAME",i=e.vcl.dataSet.getTable(0).data.items[0].get(a);r(o,i)}},beforeclose:function(e,n){this.vcl.vclHandler(e,{libEventType:LibEventTypeEnum.FormClosing}),2!==e.vcl.dataSet.getTable(0).data.items[0].get("CURRENTSTATE")&&(t===BillActionEnum.AddNew&&Ext.Msg.alert("提示","单据未生效，此时新增的数据无效"),t===BillActionEnum.Modif&&Ext.Msg.alert("提示","单据未生效，此时修改的数据无效"))},beforeshow:function(t,n){"com.TechRoute"===e&&a&&d.a.FillTechRouteGridData(t.vcl,a)}}});i.win=g,g.show(),$("#cpsLoading").css("display","none")}}},{key:"copyCpsControl",value:function(t){for(var n=t.find("div.cps-controls-span").text().split("[")[0],o=t.attr("data-progid").replace(".",""),a=Math.round(t.css("left").replace("px",""))+10,r=Math.round(t.css("top").replace("px",""))+10,i=o+"_"+parseInt(1e3*Math.random());$(l.c.canvasId).find("div[id='"+i+"']").length>0;)i=o+"_"+parseInt(1e3*Math.random());var d=t.clone().attr({id:i,"data-relid":""}).css({left:a+"px",top:r+"px"});d.find("div.cps-controls-span").text(n),d.find("div.cps-controls-region").css({"background-color":"#eceff4",border:"1px solid #bbcfde "}),$(l.c.canvasId).append(d),s.a.updateControlByControlId(!1,i),e.initSvgControlEvent(),c.a.copyCpsControl=d}},{key:"createControlMenu",value:function(){return l.b.munePanel=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",floating:!0,shadow:"drop",items:[{text:"选择",iconCls:"fa fa-eye",handler:function(){this.up("menu").hide(),e.menuControlId=e.menuControl.attr("id"),e.menuControlRelId=e.menuControl.attr("data-relid");var t=e.menuControl.find("div.cps-controls-span").text(),n=e.menuControl.attr("data-progid");"com.TechRoute"===n&&2===l.b.controlLineModels.FactoryModuleType?(toastr.info("选择标准工艺路线主数据ID之前，要为其组件右方或下方的组件布局留出足够的空白区域以便加载其数据模型覆盖当前数据模型！","系统提示"),e.showProgramDataListView(t,n,function(n,o){Ext.Msg.confirm("系统提示","是否进行标准工艺路线的数据模型复制操作？",function(a){var r="yes"===a;d.a.buildControlLayout(e.menuControlId,t,n,o,r)})})):e.showProgramDataListView(t,n,function(n,o){s.a.setControlRelIdName(e.menuControlId,t,n,o)})}},{text:"复制",iconCls:"fa fa-plus",handler:function(){this.up("menu").hide(),e.copyCpsControl(e.menuControl)}},{text:"删除",iconCls:"fa fa-trash",handler:function(){this.up("menu").hide();var t=e.menuControl.attr("id");s.a.deleteControlByControlId(t)}}],renderTo:l.b.renderTo}),l.b.munePanel}},{key:"createControlToolTip",value:function(e,t){if(l.b.descToolTip||(l.b.descToolTip=Ext.create("Ext.tip.ToolTip",{html:"跟随鼠标移动",trackMouse:!0,dismissDelay:8e3,border:"1 1 1 1",anchorOffset:10,cls:"cps-x-tip-top-default",anchor:"top",maxWidth:250,Width:250})),t){for(var n=$(l.c.canvasId).offset(),o=0,a=0,r="<b>未知数据</b><br>",i=0;i<l.b.controlLineModels.ControlDetail.length;i++){var d=l.b.controlLineModels.ControlDetail[i];if(d.ControlId===e){o=d.XCoordinate+d.ControlWidth/2+n.left-$(l.c.canvasId).scrollLeft()-5,a=d.YCoordinate+d.ControlHeight+n.top-$(l.c.canvasId).scrollTop(),r="<b>"+d.ControlDescription+"</b><br>";break}}l.b.descToolTip.update(r),l.b.descToolTip.showAt(o,a)}else l.b.descToolTip.setVisible(!1)}},{key:"getPersonalControl",value:function(e){var t=e.attr("data-progid");if(1===l.b.controlLineModels.FactoryModuleType)switch(t){case"com.ProduceLine":e.css({width:"600px",height:"60px"}),e.find("img").css({width:"30px",height:"30px"});break;case"com.WorkshopSection":e.css({width:"280px",height:"55px"}),e.find("img").css({width:"25px",height:"25px"});break;case"com.WorkProcess":e.css({width:"150px",height:"50px"}),e.find("img").css({width:"20px",height:"20px"});break;case"com.Workstation":e.css({width:"80px",height:"50px"}),e.find("img").css({width:"20px",height:"20px"})}if(2===l.b.controlLineModels.FactoryModuleType)switch(t){case"com.TechRoute":e.css({width:"70px",height:"600px"}),e.find("img").css({width:"40px",height:"40px"});break;case"com.TechRouteType":e.css({width:"50px",height:"280px"}),e.find("img").css({width:"20px",height:"20px"});break;case"com.WorkshopSection":e.css({width:"60px",height:"300px"}),e.find("img").css({width:"30px",height:"30px"});break;case"com.WorkProcess":e.css({width:"160px",height:"60px"}),e.find("img").css({width:"30px",height:"30px"});break;case"com.WorkstationConfig":case"com.Material":case"com.MaterialType":e.css({width:"160px",height:"50px"}),e.find("img").css({width:"20px",height:"20px"})}return e}},{key:"initSvgControlEvent",value:function(){e.setControlDragEvent(),e.setSvgControlOtherEvent()}},{key:"initProgramControlEvent",value:function(){e.initSvgControlEvent(),e.setControlMoveEvent()}},{key:"setControlDragEvent",value:function(){$(l.c.mainPanelId).find("div[name='cpsIcon']").unbind("dragstart").bind("dragstart",function(t){if(!l.b.useVectorLine&&!l.b.redrawCpsControl){var n=$(this).attr("id"),o=$(l.c.canvasId).find("div[id='"+n+"']");if(o.length>0)e.existControl=!0,e.canvasOffsetX=$(l.c.canvasId).offset().left-$(l.c.canvasId).scrollLeft(),e.canvasOffsetY=$(l.c.canvasId).offset().top-$(l.c.canvasId).scrollTop(),$(l.c.drawSVGId).find("circle[name='zoomCircle']").css({display:"none"}),l.b.selControlId=null,$(l.c.drawSVGId).find("circle[name='drawCircle']").css({display:"none"}),l.b.selVectorLineId=null,l.b.polylineAttrPanel.getForm().reset();else{e.existControl=!1,e.canvasOffsetX=$(l.c.canvasId).offset().left-$(this).offset().left-$(l.c.canvasId).scrollLeft(),e.canvasOffsetY=$(l.c.canvasId).offset().top-$(this).offset().top-$(l.c.canvasId).scrollTop();for(var a=n+"_"+parseInt(1e3*Math.random());$(l.c.canvasId).find("div[id='"+a+"']").length>0;)a=n+"_"+parseInt(1e3*Math.random());o=$(this).clone(),o=o.attr("id",a),o=e.getPersonalControl(o)}e.controlOffsetX=parseInt(t.clientX-o.offset().left),e.controlOffsetY=parseInt(t.clientY-o.offset().top),o.css({position:"absolute",margin:"0"}),e.dragControl=o}}),$(l.c.mainPanelId).find("div[name='cpsIcon']").unbind("dragend").bind("dragend",function(t){if(!l.b.useVectorLine&&!l.b.redrawCpsControl){var n=Math.round(e.dragControl.css("left").replace("px","")),o=Math.round(e.dragControl.css("top").replace("px","")),a=e.dragControl.attr("id");n<0||o<0?s.a.deleteControlByControlId(a):(s.a.updateControlByControlId(e.existControl,a),e.existControl||e.initSvgControlEvent())}e.existControl=!1,e.dragControl=null,t.originalEvent.preventDefault()})}},{key:"setControlMoveEvent",value:function(){$(l.c.canvasId).unbind("dragenter").bind("dragenter",function(t){if(!l.b.useVectorLine&&e.dragControl&&!l.b.redrawCpsControl){var n=e.dragControl.attr("id");if(l.b.controlsAttrPanel.getForm().findField("ControlId").getValue()!==n&&s.a.setControlAttrFormValues(e.dragControl),!e.existControl&&$(l.c.drawSVGId).find("svg[id='"+n+"']").length<=0){var o=t.clientX-e.controlOffsetX-e.canvasOffsetX,a=t.clientY-e.controlOffsetY-e.canvasOffsetY;e.dragControl.css("left",o),e.dragControl.css("top",a),$(l.c.canvasId).append(e.dragControl)}}t.originalEvent.preventDefault()}),$(l.c.canvasId).unbind("dragover").bind("dragover",function(t){if(!l.b.useVectorLine&&e.dragControl&&!l.b.redrawCpsControl){var n=t.clientX-e.controlOffsetX-e.canvasOffsetX,o=t.clientY-e.controlOffsetY-e.canvasOffsetY;e.dragControl.css("left",n),e.dragControl.css("top",o),l.b.controlsAttrPanel.getForm().findField("XCoordinate").setValue(n),l.b.controlsAttrPanel.getForm().findField("YCoordinate").setValue(o),d.a.resizeDrawSvg(e.dragControl)}t.originalEvent.preventDefault()})}},{key:"setSvgControlOtherEvent",value:function(){$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseup").bind("mouseup",function(t){l.b.useVectorLine||2===t.button&&(l.b.munePanel||e.createControlMenu(),e.menuControl=$(this),l.b.munePanel.showAt(t.clientX,t.clientY,!1),t.preventDefault())}),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("click").bind("click",function(e){l.b.useVectorLine||(l.b.selCpsControl=$(this),l.b.isSelCpsControl=!0,s.a.setControlAttrFormValues(l.b.selCpsControl),l.a.showElementPoints(l.b.selCpsControl,"zoomCircle"),l.b.selControlId=l.b.selCpsControl.attr("id"))}),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("dblclick").bind("dblclick",function(t){if(!l.b.useVectorLine){var n=$(this).attr("id"),o=$(this).attr("data-progid"),a=$(this).attr("data-relid"),r=$(this).find("div.cps-controls-span").text();if("com.TechRoute"===o&&2===l.b.controlLineModels.FactoryModuleType)toastr.info("新增或修改标准工艺路线之前，要为其组件右方或下方的组件布局留出足够的空白区域以便加载其数据模型覆盖当前数据模型！","系统提示"),e.AdditionalTechRouteData(o,n,r,a);else{var i=a?BillActionEnum.Browse:BillActionEnum.AddNew,d=a?[a]:void 0;e.showProgramDataView(o,i,d,null,null,function(e,t){s.a.setControlRelIdName(n,r,e,t)})}}}),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseenter").bind("mouseenter",function(t){if((l.b.useVectorLine||l.b.redrawVectorLine)&&l.a.showElementPoints($(this),"controlRect"),!l.b.useVectorLine&&l.b.useToolTip){var n=$(this).attr("id");e.createControlToolTip(n,!0)}}),$(l.c.canvasId).find("div[name='cpsIcon']").unbind("mouseleave").bind("mouseleave",function(t){(l.b.useVectorLine||l.b.redrawVectorLine)&&($(l.c.drawSVGId).find("rect[name='controlRect']").css({display:"none"}),l.b.positionRectPoints=null),!l.b.useVectorLine&&l.b.useToolTip&&e.createControlToolTip(null,!1)})}}]),e}();u.controlOffsetX=0,u.controlOffsetY=0,u.canvasOffsetX=0,u.canvasOffsetY=0,u.existControl=!1,u.dragControl=null,u.menuControl=null,u.menuControlId=null,u.menuControlRelId=null},580:function(e,t,n){t=e.exports=n(547)(!0),t.push([e.i,"\n.contrainer-hide[data-v-49f23532] {\n  height: 0;\n  width: 0;\n}\n.contrainer-show[data-v-49f23532] {\n  height: 100%;\n  width: 100%;\n}\n","",{version:3,sources:["D:/集控/ax-jikon-adminlte/src/components/content/layout.vue"],names:[],mappings:";AACA;EACE,UAAU;EACV,SAAS;CACV;AACD;EACE,aAAa;EACb,YAAY;CACb",file:"layout.vue",sourcesContent:["\n.contrainer-hide[data-v-49f23532] {\n  height: 0;\n  width: 0;\n}\n.contrainer-show[data-v-49f23532] {\n  height: 100%;\n  width: 100%;\n}\n"],sourceRoot:""}])},603:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content-section"},[e._l(e.contrainers,function(t){return n("section",{directives:[{name:"show",rawName:"v-show",value:e.isExt,expression:"isExt"}],ref:t,refInFor:!0})}),e._v(" "),n("router-view",{directives:[{name:"show",rawName:"v-show",value:!e.isExt,expression:"!isExt"}]})],2)},staticRenderFns:[]}},622:function(e,t,n){var o=n(580);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);n(548)("3d385bc0",o,!0)},632:function(e,t,n){n(638),n(151),n(639),n(640),e.exports=n(31).Symbol},633:function(e,t,n){n(71),n(94),e.exports=n(565).f("iterator")},634:function(e,t,n){var o=n(229),a=n(569),r=n(563);e.exports=function(e){var t=o(e),n=a.f;if(n)for(var i,l=n(e),d=r.f,s=0;l.length>s;)d.call(e,i=l[s++])&&t.push(i);return t}},635:function(e,t,n){var o=n(229),a=n(90);e.exports=function(e,t){for(var n,r=a(e),i=o(r),l=i.length,d=0;l>d;)if(r[n=i[d++]]===t)return n}},636:function(e,t,n){var o=n(563),a=n(91),r=n(90),i=n(231),l=n(63),d=n(232),s=Object.getOwnPropertyDescriptor;t.f=n(37)?s:function(e,t){if(e=r(e),t=i(t,!0),d)try{return s(e,t)}catch(e){}if(l(e,t))return a(!o.f.call(e,t),e[t])}},637:function(e,t,n){var o=n(90),a=n(568).f,r={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],l=function(e){try{return a(e)}catch(e){return i.slice()}};e.exports.f=function(e){return i&&"[object Window]"==r.call(e)?l(e):a(o(e))}},638:function(e,t,n){"use strict";var o=n(38),a=n(63),r=n(37),i=n(55),l=n(235),d=n(148).KEY,s=n(70),c=n(150),u=n(92),p=n(93),f=n(27),h=n(565),g=n(564),m=n(635),v=n(634),y=n(233),C=n(54),b=n(90),I=n(231),x=n(91),E=n(149),w=n(637),S=n(636),M=n(32),L=n(229),k=S.f,T=M.f,P=w.f,A=o.Symbol,V=o.JSON,R=V&&V.stringify,N=f("_hidden"),O=f("toPrimitive"),D={}.propertyIsEnumerable,$=c("symbol-registry"),F=c("symbols"),W=c("op-symbols"),G=Object.prototype,H="function"==typeof A,B=o.QObject,z=!B||!B.prototype||!B.prototype.findChild,_=r&&s(function(){return 7!=E(T({},"a",{get:function(){return T(this,"a",{value:7}).a}})).a})?function(e,t,n){var o=k(G,t);o&&delete G[t],T(e,t,n),o&&e!==G&&T(G,t,o)}:T,U=function(e){var t=F[e]=E(A.prototype);return t._k=e,t},Y=H&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},j=function(e,t,n){return e===G&&j(W,t,n),C(e),t=I(t,!0),C(n),a(F,t)?(n.enumerable?(a(e,N)&&e[N][t]&&(e[N][t]=!1),n=E(n,{enumerable:x(0,!1)})):(a(e,N)||T(e,N,x(1,{})),e[N][t]=!0),_(e,t,n)):T(e,t,n)},X=function(e,t){C(e);for(var n,o=v(t=b(t)),a=0,r=o.length;r>a;)j(e,n=o[a++],t[n]);return e},q=function(e,t){return void 0===t?E(e):X(E(e),t)},K=function(e){var t=D.call(this,e=I(e,!0));return!(this===G&&a(F,e)&&!a(W,e))&&(!(t||!a(this,e)||!a(F,e)||a(this,N)&&this[N][e])||t)},J=function(e,t){if(e=b(e),t=I(t,!0),e!==G||!a(F,t)||a(W,t)){var n=k(e,t);return!n||!a(F,t)||a(e,N)&&e[N][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=P(b(e)),o=[],r=0;n.length>r;)a(F,t=n[r++])||t==N||t==d||o.push(t);return o},Z=function(e){for(var t,n=e===G,o=P(n?W:b(e)),r=[],i=0;o.length>i;)!a(F,t=o[i++])||n&&!a(G,t)||r.push(F[t]);return r};H||(A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(W,n),a(this,N)&&a(this[N],e)&&(this[N][e]=!1),_(this,e,x(1,n))};return r&&z&&_(G,e,{configurable:!0,set:t}),U(e)},l(A.prototype,"toString",function(){return this._k}),S.f=J,M.f=j,n(568).f=w.f=Q,n(563).f=K,n(569).f=Z,r&&!n(230)&&l(G,"propertyIsEnumerable",K,!0),h.f=function(e){return U(f(e))}),i(i.G+i.W+i.F*!H,{Symbol:A});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)f(ee[te++]);for(var ee=L(f.store),te=0;ee.length>te;)g(ee[te++]);i(i.S+i.F*!H,"Symbol",{for:function(e){return a($,e+="")?$[e]:$[e]=A(e)},keyFor:function(e){if(Y(e))return m($,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),i(i.S+i.F*!H,"Object",{create:q,defineProperty:j,defineProperties:X,getOwnPropertyDescriptor:J,getOwnPropertyNames:Q,getOwnPropertySymbols:Z}),V&&i(i.S+i.F*(!H||s(function(){var e=A();return"[null]"!=R([e])||"{}"!=R({a:e})||"{}"!=R(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!Y(e)){for(var t,n,o=[e],a=1;arguments.length>a;)o.push(arguments[a++]);return t=o[1],"function"==typeof t&&(n=t),!n&&y(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!Y(t))return t}),o[1]=t,R.apply(V,o)}}}),A.prototype[O]||n(43)(A.prototype,O,A.prototype.valueOf),u(A,"Symbol"),u(Math,"Math",!0),u(o.JSON,"JSON",!0)},639:function(e,t,n){n(564)("asyncIterator")},640:function(e,t,n){n(564)("observable")},641:function(e,t,n){e.exports={default:n(632),__esModule:!0}},642:function(e,t,n){e.exports={default:n(633),__esModule:!0}},643:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var a=n(642),r=o(a),i=n(641),l=o(i),d="function"==typeof l.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?"symbol":typeof e};t.default="function"==typeof l.default&&"symbol"===d(r.default)?function(e){return void 0===e?"undefined":d(e)}:function(e){return e&&"function"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?"symbol":void 0===e?"undefined":d(e)}},648:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(142),a=n.n(o),r=n(69),i=n(196),l=n(668),d=n(665),s=n(663),c=n(664),u=n(228),p=n(238),f=n(239),h=n(669),g=n(42);t.default={data:function(){return{subscribe:null,isExt:!0}},computed:{contrainers:function(){return u.NavHeaderItemUtility.getContrainers()},headerItem:function(){return this.$store.state.mainHeader.selectedItem}},beforeMount:function(){this.subscribeChanged()},mounted:function(){this.init()},beforeDestroy:function(){this.subscribe()},methods:{init:function(){h.a.toastrInit(),f.a.connectionInit(),Ax.utils.LibVclSystemUtils.loadVueStore(this.$store,r),c.a.onInit(this.headerItemChanged),s.a.onInit(this.headerItemChanged),this.setDefaultHeaderItem()},setDefaultHeaderItem:function(){var e=this,t=g.a.getHeaderItem();t||(t=u.NavHeaderItemUtility.getDefaultHeaderItem()),this.$nextTick(function(){g.a.setHeaderItem(t),e.$store.dispatch(r.MAIN_HEADER_SELECTED_ITEM,{selectedItem:t})})},subscribeChanged:function(){var e=this;this.subscribe=this.$store.subscribe(function(t,n){t.type===r.MAIN_HEADER_SELECTED_ITEM&&(e.isExt=!0,e.$router.push("/layout/content/"),e.headerItemChanged(t.payload.selectedItem)),t.type===r.MAIN_SIDEBAR_SELECTED_ITEM&&("PUBLISH"===t.payload.selectedItem.item.PROGID?(e.isExt=!1,e.$router.push("/layout/content/publish/pull")):(e.isExt=!0,e.$router.push("/layout/content/"),e.sideItemChanged(t.payload.selectedItem.item)))})},sideItemChanged:function(e){var t=this.getExtComponent(this.headerItem.contrainer);t&&(this.reRender(t),t.itemClick(e))},headerItemChanged:function(e){this.isExt=!0,this.$router.push("/layout/content/"),this.setMainSidebarEnabled(!0);var t=e.contrainer;this.setContrainer(t);var n=this.getExtComponent(t);n||(this.initContrainer(t),n=this.getExtComponent(t)),this.setSidebarEnabledByContrainer(t),this.reRender(n)},initContrainer:function(e){var t=this.$refs[e][0];switch(e){case u.EnumNavHeader.workbench:this.putExtComponent(l.a.getControl(t),e);break;case u.EnumNavHeader.menuConfig:this.putExtComponent(d.a.onSetMenu(t),e);break;case u.EnumNavHeader.document:this.putExtComponent(c.a.onSetMenu(t),e);break;case u.EnumNavHeader.cpsModel:this.putExtComponent(s.a.onSetMenu(t),e);break;default:this.putExtComponent(i.a.getControl(t),e)}},setSidebarEnabledByContrainer:function(e){switch(e){case u.EnumNavHeader.menuConfig:case u.EnumNavHeader.document:case u.EnumNavHeader.cpsModel:this.setMainSidebarEnabled(!1)}},setContrainer:function(e){var t=!0,n=!1,o=void 0;try{for(var r,i=a()(this.contrainers);!(t=(r=i.next()).done);t=!0){var l=r.value,d=this.$refs[l];d[0].className=e===l?"contrainer-show":"contrainer-hide"}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}},reRender:function(e){this.$nextTick(function(){try{p.a.contrainer=e,e.updateLayout()}catch(e){console.error(e)}})},setMainSidebarEnabled:function(e){this.$store.dispatch(r.MAIN_SIDEBAR_SEARCH_ENABLED,{isEnabled:e}),this.$store.dispatch(r.MAIN_SIDEBAR_MENU_ENABLED,{isEnabled:e})}}}},662:function(e,t,n){"use strict";var o=n(558),a=n(559),r=n(567),i=n(560),l=n(561),d=n(562);Ext.define("CPSConfigureManage.CpsConfigureMain",{init:function(){this.launcher={text:"CPS建模",iconCls:"menuIco"}},createAttrPanel:function(){var e=parseInt($(".content-section").css("height").replace("px",""))-50,t=i.a.createControlAttrPanel(),n=l.a.createPolylineAttrPanel();return o.b.attrFormPanels=Ext.create("Ext.panel.Panel",{border:!1,width:250,height:"100%",maxHeight:e,autoScroll:!0,flex:0,layout:"vbox",items:[t,n]}),o.b.attrFormPanels},createCpsFactoryModule:function(e,t,n){var i=d.a.createEventPanel(),l=a.a.createMainPanel(),s=this.createAttrPanel(),c=Ext.create("Ext.panel.Panel",{id:"CpsConfigureWinId",header:!1,draggable:!1,resizable:!1,width:"100%",height:"100%",iconCls:"gears",animCollapse:!1,border:!1,layout:"vbox",items:[{xtype:"panel",border:!0,width:"100%",height:50,flex:0,layout:"fit",items:[i]},{xtype:"panel",border:!1,width:"100%",flex:1,layout:"hbox",autoScroll:!0,items:[l,s]}],renderTo:e,style:{"border-radius":"0px !important;","background-color":"#4a9dcf !important;","border-color":"#4a9dcf !important;"}});return o.b.renderTo=e,r.a.loadSystemControlConfigVue(),n||a.a.selFactoryModuleType(t,n),c}})},663:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(42),d=n(228),s=n(558),c=n(559),u=(n(570),n(662),function(){function e(){a()(this,e)}return i()(e,null,[{key:"onInit",value:function(t){e.Instance||(e.Instance=Ext.create("CPSConfigureManage.CpsConfigureMain",{})),e.gotoMenu=t;for(var n=void 0,o=0;o<d.NavHeaderItems.length;o++)if(d.NavHeaderItems[o]&&"CPS建模"===d.NavHeaderItems[o].text){n=d.NavHeaderItems[o];break}e.CpsConfigureItem=n||{key:d.EnumNavHeader.cpsModel,text:"CPS建模",contrainer:"cpsModel"},CPSConfigureManage.CpsConfigureMain.jumpTo=e.jumpTo,CPSConfigureManage.CpsConfigureMain.loadCanvas=e.loadCanvas}},{key:"jumpTo",value:function(t,n,o){e.LastItem=l.a.getHeaderItem();var a=e.CpsConfigureItem;l.a.setHeaderItem(a),e.gotoMenu(a),c.a.factoryModuleTypeWin.close(),c.a.loadCpsConfigureView(t,n,o)}},{key:"loadCanvas",value:function(e){s.a.getProduceControlLineList(e,function(e){s.b.controlLineModels=e,c.a.showProduceControlLineModels()})}},{key:"onSetMenu",value:function(t){return e.Instance||(e.Instance=Ext.create("CPSConfigureManage.CpsConfigureMain",{})),e.Instance.createCpsFactoryModule(t,void 0,void 0)}}]),e}())},664:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=n(42),d=(n(69),n(228)),s=function(){function e(){a()(this,e)}return i()(e,null,[{key:"onInit",value:function(t){try{null==e.Instance&&(Ext.Loader.setPath("DocumentManage","/Scripts/ax/dm"),e.Instance=Ext.create("DocumentManage.DocumentMain",{})),e.gotoMenu=t;var n=d.NavHeaderItems.filter(function(e){return!(!e||"文档管理"!==e.text)});n&&n.length>0?e.DocumentItem=n[0]:e.DocumentItem={key:EnumNavHeader.document,text:"文档管理",contrainer:"document"},DocumentManage.DocumentMain.JumpTo=e.JumpTo,DocumentManage.DocumentMain.JumpBack=e.JumpBack}catch(e){console.log(e)}}},{key:"JumpTo",value:function(t,n,o){e.LastItem=l.a.getHeaderItem();var a=e.DocumentItem;l.a.setHeaderItem(a),e.gotoMenu(a),new Ext.util.DelayedTask(function(){e.Instance.dirDocViewTab||e.Instance.autoExpandFirstNode(),e.Instance.dirDocViewTab.jumpTo(t,n,o)}).delay(1e3)}},{key:"JumpBack",value:function(){if(e.LastItem&&e.LastItem!=e.DocumentItem){var t=e.LastItem;l.a.setHeaderItem(t),e.gotoMenu(t)}}},{key:"onSetMenu",value:function(t){var n="DocumentMainPanel_FixId";DesktopApp.ActiveWindow=n,null==e.Instance&&(Ext.Loader.setPath("DocumentManage","/Scripts/ax/dm"),e.Instance=Ext.create("DocumentManage.DocumentMain",{}));var o=e.Instance.createMainPanel(t,n);return e.Instance.autoExpandFirstNode(),o}}]),e}()},665:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(643),a=n.n(o),r=n(19),i=n.n(r),l=n(26),d=n.n(l),s=function(){function e(){i()(this,e)}return d()(e,null,[{key:"onSetMenu",value:function(e){var t=Ext.id();DesktopApp.ActiveWindow=t;var n=Ax.utils.LibVclSystemUtils.loadMenuData(!0),o=Ext.data.Model.schema.getEntity("LibMenuSettingModel");null===o&&(o=Ext.define("LibMenuSettingModel",{extend:"Ext.data.Model",fields:[{name:"MENUITEM",type:"string"},{name:"PROGID",type:"string"},{name:"PROGNAME",type:"string"},{name:"BILLTYPE",type:"int"},{name:"ENTRYPARAM",type:"string"},{name:"ISVISUAL",type:"boolean"},{name:"CONDITION",type:"string"},{name:"ENABLETREELISTING",type:"boolean"},{name:"TREECOLUMNNAME",type:"string"}]}));var r=Ext.create("Ext.data.TreeStore",{model:"LibMenuSettingModel",proxy:{type:"memory",reader:{type:"json"}},root:n||{expanded:!0,children:[{MENUITEM:"业务功能",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,leaf:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""},{MENUITEM:"报表管理",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,leaf:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""},{MENUITEM:"KPI管理",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,leaf:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""},{MENUITEM:"看板管理",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,leaf:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""},{MENUITEM:"文档管理",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,leaf:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""}]}}),i=["业务功能","报表管理","KPI管理","看板管理","文档管理"],l=Ext.create("Ext.tree.Panel",{width:300,flex:0,store:r,displayField:"MENUITEM",rootVisible:!1,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],dockedItems:[{xtype:"toolbar",items:[{text:"保存",handler:function(){var e=r.getRootNode();!function(){Ext.Ajax.request({url:"fileTranSvc/saveMenuSetting",jsonData:{handle:UserHandle,menuData:Ext.encode(e.serialize())},method:"POST",success:function(e){Ext.Msg.alert("提示","保存成功！")},failure:function(){Ext.Msg.alert("错误","保存失败！")}})}()}},{text:"取消",handler:function(){var e=Ax.utils.LibVclSystemUtils.loadMenuData(!0);e.expanded=!0,r.setRoot(e);var t=Ext.create("LibMenuSettingModel",{MENUITEM:"",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,ENABLETREELISTING:!1,TREECOLUMNNAME:""});c.loadRecord(t)}}]}],viewConfig:{plugins:{ptype:"treeviewdragdrop",dragText:"{0} 选中节点",allowContainerDrop:!0,allowParentInsert:!0,containerScroll:!0,sortOnDrop:!0}},listeners:{itemcontextmenu:function(e,t,n,o,a,r){a.preventDefault();new Ext.menu.Menu({items:[{text:"新增节点",iconCls:"gridAdd",handler:function(){Ext.Array.contains(i,t.get("MENUITEM"))||d(t,!1)}},{text:"新增子节点",iconCls:"gridAdd",handler:function(){d(t,!0)}},{text:"删除节点",iconCls:"gridDelete",handler:function(){Ext.Array.contains(i,t.get("MENUITEM"))||t.remove()}}]}).showAt(a.getXY())},itemclick:function(e,t,n,o,r,i){var d=l.getSelectionModel().getLastSelected();c.loadRecord(d);var s=d.get("PROGID");if(s&&""!=s){var u=c.down("libSearchfield");u.getStore().add({Id:s,Name:d.get("PROGNAME")}),u.select(s),u.fieldType=void 0===s?"undefined":a()(s)}}}});l.expand();var d=function(e,t){var n=Ext.create("LibMenuSettingModel",{MENUITEM:"",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1,expanded:!0,id:Ax.utils.LibVclSystemUtils.newGuid()});return t?e.appendChild(n):e.parentNode.appendChild(n),n},s=function(e){var n=c.getRecord();if(n){n.set(e,"");var o=l.getSelectionModel().getLastSelected();if(o){o.beginEdit();try{o.set(e,"")}finally{o.endEdit()}}Ext.getCmp(e+"0_"+t).setValue("")}},c=Ext.create("Ext.form.Panel",{flex:1,tbar:[{xtype:"button",text:"设置入口参数",handler:function(){var e=c.getRecord();if(e){var t=e.get("ENTRYPARAM"),n=e.get("PROGID");n?(t=t.length>0?Ext.decode(t).ParamStore:void 0,Ax.utils.LibEntryParam.createForm(h,n,t)):alert("请先选择功能。")}}},{xtype:"button",text:"清除入口参数",handler:function(){s("ENTRYPARAM")}},{xtype:"button",text:"设置条件",handler:function(){var e=c.getRecord();if(e){var t=e.get("CONDITION"),n=e.get("PROGID");n?(t=t.length>0?Ext.decode(t).QueryFields:void 0,Ax.utils.LibQueryForm.createForm(h,n,t)):alert("请先选择功能。")}}},{xtype:"button",text:"清除条件",handler:function(){s("CONDITION")}}],border:!1,items:[{xtype:"container",layout:{type:"table",columns:1},style:{marginTop:"6px",marginBottom:"6px"},defaults:{labelAlign:"right"},defaultType:"libTextField",items:[{xtype:"libTextField",height:24,width:600,colspan:1,fieldLabel:"清单名称",name:"MENUITEM",tableIndex:0},{xtype:"libSearchfield",height:24,width:600,colspan:2,fieldLabel:"功能",relSource:{"axp.FuncList":""},relName:"PROGNAME",relPk:"",selParams:[],name:"PROGID",tableIndex:0,selectFields:"A.PROGNAME,A.BILLTYPE",condition:"A.CANMENU=1"},{xtype:"libTextField",height:24,width:600,colspan:1,readOnly:!0,fieldLabel:"(功能名称)",name:"PROGNAME",tableIndex:0},{xtype:"libComboboxField",height:24,width:600,colspan:1,readOnly:!0,fieldLabel:"(功能类型)",queryMode:"local",editable:!1,displayField:"value",valueField:"key",store:Ext.create("Ext.data.Store",{fields:["key","value"],data:[{key:0,value:"主数据"},{key:1,value:"单据"},{key:2,value:"数据维护功能"},{key:3,value:"自定义功能"},{key:4,value:"报表"},{key:5,value:"日报表"}]}),name:"BILLTYPE",tableIndex:0},{xtype:"libTextAreaField",height:100,width:600,colspan:1,readOnly:!0,fieldLabel:"(入口参数)",name:"ENTRYPARAM",tableIndex:0},{xtype:"libCheckboxField",fieldLabel:"是否看板",name:"ISVISUAL",tableIndex:0},{xtype:"libTextAreaField",height:200,width:600,colspan:1,readOnly:!0,fieldLabel:"(条件)",name:"CONDITION",tableIndex:0}]}]}),u=Ext.create("LibMenuSettingModel",{MENUITEM:"",PROGID:"",PROGNAME:"",BILLTYPE:1,ENTRYPARAM:"",CONDITION:"",ISVISUAL:!1});c.loadRecord(u);var f=Ext.create("Ext.resizer.Splitter",{border:5,style:{borderColor:"#eae4e4",borderStyle:"solid"}}),h={proxy:!0,vclHandler:function(e,n){switch(n.libEventType){case LibEventTypeEnum.Validating:Ext.Array.contains(i,n.dataInfo.dataRow.get("MENUITEM"))&&(n.dataInfo.cancel=!0);break;case LibEventTypeEnum.Validated:if("PROGID"==n.dataInfo.fieldName){var o=n.dataInfo.dataRow.get("PROGNAME"),a=Ext.getCmp("PROGNAME0_"+t);a.setValue(o),a=Ext.getCmp("MENUITEM0_"+t),a.setValue(o),a=Ext.getCmp("ISVISUAL0_"+t),a.setValue(!1),a=Ext.getCmp("CONDITION0_"+t),a.setValue(""),a=Ext.getCmp("ENTRYPARAM0_"+t),a.setValue("");var r=l.getSelectionModel().getLastSelected();if(r){r.beginEdit();try{r.set("MENUITEM",o),r.set("PROGID",n.dataInfo.value),r.set("PROGNAME",o),r.set("BILLTYPE",n.dataInfo.dataRow.get("BILLTYPE")),r.set("ISVISUAL",!1),r.set("CONDITION",""),r.set("ENTRYPARAM",""),r.set("leaf",""!=n.dataInfo.value)}finally{r.endEdit()}}}else if("MENUITEM"==n.dataInfo.fieldName||"ISVISUAL"==n.dataInfo.fieldName){var d=l.getSelectionModel().getLastSelected();if(d){d.beginEdit();try{d.set(n.dataInfo.fieldName,n.dataInfo.value)}finally{d.endEdit()}}}if("libSearchfield"==e.xtype){var s=n.dataInfo,c=(s&&s.tableIndex,s&&s.fieldName,e.store.find("Id",s.value));-1!=c?s.dataRow.set(e.relName,e.store.data.items[c].get("Name")):s.dataRow.set(e.relName,"");var u;if(e.realRelSource)u=e.realRelSource;else{var f={};u=Ax.utils.LibSysUtils.getRelSource(e,s,e.xcontainer.vcl,f),f.hasRealRelSource&&(e.realRelSource=u)}if(!0===e.win.vcl.proxy){if(e.selectFields){var h=function(t){var o,a="function"==typeof this.condition?this.condition():this.condition?"and "+this.condition:"";if(Ext.Ajax.request({url:"/billSvc/checkFieldValue",jsonData:{handle:UserHandle,fields:e.selectFields,relSource:t,curPk:s.value,condition:a,tableIndex:e.tableIndex},method:"POST",async:!1,timeout:9e7,success:function(e){var t=Ext.decode(e.responseText);o="{}"!==t.CheckFieldValueResult?Ext.decode(t.CheckFieldValueResult):null}}),o){for(p in o)if(o.hasOwnProperty(p)){var r=o[p];if(void 0!==r&&null!==r&&s.dataRow&&null!=s.dataRow.getField(p)){s.dataRow.set(p,r);var i=Ext.getCmp(p+n.dataInfo.tableIndex+"_"+e.win.getId());i&&("libSearchfield"==i.xtype?(i.store.add({Id:o[i.name],Name:o[i.relName]}),i.select(o[i.name])):i.setValue(r))}}}else s.dataRow.set(e.relName,""),s.dataRow.set("PROGID","")};h.call(e,u)}}else e.win.vcl.doCheckField(s.tableIndex,s.fieldName,u,e.relPk,s.value,s.dataRow,s.curGrid);s.curForm&&s.curForm.loadRecord(s.dataRow)}}},formCallBackHandler:function(e,t){if("SYSTEM_QUERY"==e){var n=Ext.encode({QueryFields:t.condition});g("CONDITION",n)}else if("ENTRY_PARAM"==e){var o=Ext.encode(t.condition);g("ENTRYPARAM",o)}}},g=function(e,n){var o=c.getRecord();if(o){o.set(e,n);var a=l.getSelectionModel().getLastSelected();if(a){a.beginEdit();try{a.set(e,n)}finally{a.endEdit()}}Ext.getCmp(e+"0_"+t).setValue(n)}};return Ext.create("Ext.panel.Panel",{containerpanel:!0,id:t,isVcl:!0,title:"菜单设置",autoScroll:!0,width:"100%",height:"100%",layout:{type:"hbox",align:"stretch"},minimizable:!1,maximizable:!1,modal:!0,vcl:h,items:[l,f,c],renderTo:e})}}]),e}()},666:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(153),a=n.n(o),r=n(19),i=n.n(r),l=n(26),d=n.n(l),s=n(227),c=function(){function e(){i()(this,e)}return d()(e,null,[{key:"getControl",value:function(){return Ext.create("Container.MessageControl",{height:"100%",width:"100%"})}}]),e}();c.id=s.ConsoleItemKey.MESSAGES,Ext.define("Container.MessageControl",{extend:"Ext.panel.Panel",header:!0,title:"我的消息",animCollapse:!1,constrainHeader:!0,closable:!0,layout:{type:"vbox",align:"stretch"},requires:["Ext.data.ArrayStore","Ext.util.Format","Ext.grid.Panel","Ext.grid.RowNumberer"],init:function(){this.launcher={text:"我的消息",iconCls:"msgIco"}},create:function(){var e=Ext.data.Model.schema.getEntity("MyMessage");null===e&&(e=Ext.define("MyMessage",{extend:"Ext.data.Model",fields:[{name:"NewsId",type:"string"},{name:"Title",type:"string"},{name:"MainContent",type:"string"},{name:"InfoId",type:"string"},{name:"PersonName",type:"string"},{name:"CreateDate",type:"int"},{name:"CreateTime",type:"int"},{name:"IsRead",type:"bool"},{name:"ProgId",type:"string"},{name:"DisplayText",type:"string"},{name:"BillType",type:"int"},{name:"CurPks",type:"string"},{name:"EntryParam",type:"string"},{name:"SourceSiteId",type:"string"},{name:"SourceSiteName",type:"string"},{name:"SourceSiteFullName",type:"string"},{name:"SourceSiteUrl",type:"string"}]}));var t=[];Ext.Ajax.request({url:"billSvc/getMyNews",method:"POST",jsonData:{handle:UserHandle,startTime:0,onlyUnRead:!0},async:!1,timeout:9e7,success:function(e){var n=Ext.decode(e.responseText);t=n.GetMyNewsResult}});var n=Ext.create("Ext.data.Store",{model:e,data:t,sorters:[{property:"CreateDate",direction:"DESC"},{property:"CreateTime",direction:"DESC"}]}),o=Ext.create("Ext.form.field.Checkbox",{boxLabel:"显示已读信息",labelAlign:"right"}),r=Ext.create("Ext.grid.Panel",{store:n,collapsible:!1,selType:"checkboxmodel",multiSelect:!0,plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p>{MainContent}</p>")}],dockedItems:[{dock:"top",xtype:"toolbar",items:[{text:"标记为已读",handler:function(){for(var e=[],t=r.getSelectionModel().getSelection(),n=0;n<t.length;n++)t[n].get("IsRead")||(t[n].set("IsRead",!0),e.push(t[n].get("NewsId")));e.length>0&&Ext.Ajax.request({url:"billSvc/setMyNewsReadState",method:"POST",jsonData:{handle:UserHandle,newsList:e},async:!1,timeout:9e7,success:function(e){var t=Ext.decode(e.responseText);t=t.SetMyNewsReadStateResult,null!=t&&""!=t||(t="已标记成功。"),Ext.Msg.alert("提示",t)}})}},o,{text:"刷新列表",handler:function(){Ext.Ajax.request({url:"billSvc/getMyNews",method:"POST",jsonData:{handle:UserHandle,startTime:0,onlyUnRead:!o.getValue()},async:!1,timeout:9e7,success:function(e){var n=Ext.decode(e.responseText);t=n.GetMyNewsResult,r.getStore().loadData(t)}})}}]}],columns:[{text:"主题",flex:1,dataIndex:"Title",summaryType:"count",summaryRenderer:function(e,t,n){return 0===e||e>1?"("+e+" 条)":"(1 条)"}},{text:"信息",xtype:"actioncolumn",width:60,items:[{iconCls:"icon-grid",tooltip:"查看",scope:this,handler:function(e,t,n){var o=e.getStore().getAt(t);if(function(e){var t=!1;return Ext.Ajax.request({url:"billSvc/canUseFunc",method:"POST",jsonData:{handle:UserHandle,progId:e},async:!1,timeout:9e7,success:function(e){var n=Ext.decode(e.responseText);t=n.CanUseFuncResult}}),t}(o.get("ProgId"))){var r=o.get("InfoId"),i=o.get("BillType"),l=o.get("SourceSiteId"),d=o.get("SourceSiteFullName");if(null!=r&&""!=r)if(null!=l&&""!=l){var s=function(){var e="";return Ext.Ajax.request({url:"sysSvc/getToken",method:"POST",jsonData:{userHandle:UserHandle},async:!1,timeout:9e7,success:function(t){var n=Ext.decode(t.responseText);e=n.GetTokenResult}}),e}(),c=Ext.decode(o.get("CurPks")),u=null;c&&c.length>0&&null!=(u=o.get("EntryParam"))&&""!=u&&(u=Ext.decode(u));var p={UserId:UserId,Token:s,BillType:i,ProgId:o.get("ProgId"),CurPks:c,EntryParam:u,InfoId:r,DisplayText:o.get("DisplayText")},f=o.get("SourceSiteUrl"),h=f+"/#/ssobill?bill="+encodeURIComponent(a()(p));window.open(h,d)}else switch(i){case 0:case 1:var c=Ext.decode(o.get("CurPks"));if(c&&c.length>0){var u=o.get("EntryParam");null!=u&&""!=u&&(u=Ext.decode(u)),Ax.utils.BillManager.openBillByF4(o.get("ProgId"),BillActionEnum.Browse,c,u)}break;case 4:case 5:Ax.utils.BillManager.openRpt(o.get("ProgId"),o.get("DisplayText"),r)}}else alert("没有该信息的查看权限。")}}]},{text:"发送人员",width:80,dataIndex:"PersonName"},{text:"来源站点",width:100,dataIndex:"SourceSiteName"},{text:"日期",width:120,dataIndex:"CreateDate",xtype:"libDatecolumn",axT:1},{text:"时间",width:75,dataIndex:"CreateTime",xtype:"libDatecolumn",axT:3},{text:"已读",width:75,dataIndex:"IsRead",xtype:"libCheckcolumn"}]});this.height="100%",this.items.add(r)}})},667:function(e,t,n){"use strict";function o(e,t,n,o){return Ext.create("Ext.window.Window",{align:"middle",closable:!0,constrain:!0,width:"60%",height:"80%",plain:!0,resizable:!1,title:e,titleAlign:"center",layout:"fit",items:[Ext.create("Ext.panel.Panel",{border:!0,flex:1,style:{background:"white"},html:'<div style="width:100%;height:100%;margin-top:10px;"><table border="0" style="width:100%;height:75px;"><tbody><tr><td style="text-align:center;word-wrap:break-word;word-break:break-all;font-size:25px;font-weight:bold;line-height:28px;">'+t+'</td><td style="width:100px;text-align:center;color:grey;font-size:18px;">'+n+'</td></tr></tbody></table><textarea readonly="readonly" class="x-form-text x-form-text-default x-form-textarea" autocomplete="off" style="padding: 0px 10px;height: calc(100% - 95px);">'+o+"</textarea></div>"})]})}n.d(t,"a",function(){return s});var a=n(19),r=n.n(a),i=n(26),l=n.n(i),d=n(227),s=function(){function e(){r()(this,e)}return l()(e,null,[{key:"getControl",value:function(){return Ext.create("Container.OaHomeControl",{height:"100%",width:"100%"})}}]),e}();s.id=d.ConsoleItemKey.OA_HOME,Ext.define("Container.OaHomeControl",{extend:"Ext.panel.Panel",header:!0,title:"首页",animCollapse:!1,constrainHeader:!0,closable:!0,layout:{type:"hbox",align:"stretch"},init:function(){},create:function(){var e=Ext.create("Ext.data.Store",{model:"OAHome.OaNotice",proxy:{type:"ajax",url:"/Desk/GetNoticeList",reader:new Ext.data.JsonReader({model:"OAHome.OaNotice"})},autoLoad:!0}),t=Ext.create("Ext.grid.Panel",{title:"公告",width:"100%",flex:3,border:!0,style:{background:"white"},hideHeaders:!0,forceFit:!0,store:e,columns:[{header:"内容",width:50,dataIndex:"Content",sortable:!0,hidden:!0},{header:"标题",dataIndex:"Title",flex:1,sortable:!0},{header:"创建时间",width:100,dataIndex:"CreateTime",sortable:!0}],listeners:{itemdblclick:function(e,t,n,a,r){o("公告",t.get("Title"),t.get("CreateTime"),t.get("Content")).show()}}}),n=Ext.create("Ext.data.Store",{model:"OAHome.OaNotice",proxy:{type:"ajax",url:"/Desk/GetNewsList",reader:new Ext.data.JsonReader({model:"OAHome.OaNotice"})},autoLoad:!0}),a=Ext.create("Ext.grid.Panel",{title:"公司动态",width:"100%",flex:3,border:!0,style:{background:"white"},hideHeaders:!0,forceFit:!0,store:n,columns:[{header:"内容",width:50,dataIndex:"Content",sortable:!0,hidden:!0},{header:"标题",dataIndex:"Title",flex:1,sortable:!0},{header:"创建时间",width:100,dataIndex:"CreateTime",sortable:!0}],listeners:{itemdblclick:function(e,t,n,a,r){o("公司动态",t.get("Title"),t.get("CreateTime"),t.get("Content")).show()}}}),r=Ext.create("Ext.data.Store",{model:"OAHome.OaNotice",proxy:{type:"ajax",url:"/Desk/GetLinksList",reader:new Ext.data.JsonReader({model:"OAHome.OaNotice"})},autoLoad:!0}),i=Ext.create("Ext.grid.Panel",{title:"友情链接",width:"100%",flex:2,style:{background:"white"},hideHeaders:!0,forceFit:!0,store:r,columns:[{text:"左边链接",xtype:"templatecolumn",tpl:'<a href="{Content}" target="_blank">{Title}</a>',flex:1},{text:"右边链接",xtype:"templatecolumn",tpl:'<a href="{Content2}" target="_blank">{Title2}</a>',flex:1}]}),l=Ext.create("Ext.panel.Panel",{title:"知识管理",width:"100%",flex:1,border:!0,style:{background:"white"},html:'<div style="width:100%;height:100%;"></div>'});$.ajax({dataType:"json",url:"/Desk/GetKnowledgeList",type:"POST",async:!0,data:{},contentType:"application/x-www-form-urlencoded",success:function(e){var t="&nbsp;";if(e.length>0){var n=e[0];t='<div style="width:100%;height:100%;margin-top:10px;"><table style="width:100%;height:75px;"><tbody><tr><td style="text-align:center;word-wrap:break-word;word-break:break-all;font-size:25px;font-weight:bold;line-height:28px;">'+n.Title+'</td><td style="width:100px;text-align:center;color:grey;font-size:18px;">'+n.CreateTime+'</td></tr></tbody></table><textarea readonly="readonly" class="x-form-text x-form-text-default x-form-textarea" autocomplete="off" style="padding:0px 10px;height:calc(100% - 95px);">'+n.Content+"</textarea></div>"}l.update(t)}});var d=Ext.create("Ext.panel.Panel",{title:"图片区域",width:"100%",height:300,flex:0,border:!0,style:{background:"white"},html:'<div id="changeIamges" style="width:100%;height:100%;display:block;position:absolute;">&nbsp;</div>'});$.ajax({dataType:"json",url:"/Desk/GetImageList",type:"POST",async:!0,data:{},contentType:"application/x-www-form-urlencoded",success:function(e){var t="";if(e.length>0){for(var n=0;n<e.length;n++)t=0==n?t+'<img name="smallPic" style="max-width:100%;max-height:100%;display: block;margin:0 auto;" src="'+e[n]+'" />':t+'<img name="smallPic" style="max-width:100%;max-height:100%;display: none;margin:0 auto;" src="'+e[n]+'" />';t='<div id="changeIamges" style="width:100%;height:100%;display:block;position:absolute;">'+t+"</div>";var o=1;setInterval(function(){var t=0==o?e.length-1:o-1;$("#changeIamges").find("img").eq(t).css("display","none"),$("#changeIamges").find("img").eq(o).css("display","block"),o++,o=o==e.length?0:o},2e3)}d.update(t)}}),this.items.add(Ext.create("Ext.panel.Panel",{flex:2,layout:"vbox",height:"100%",items:[t,a,i]})),this.items.add(Ext.create("Ext.panel.Panel",{flex:3,layout:"vbox",height:"100%",items:[d,l]}))}}),Ext.define("OAHome.OaNotice",{extend:"Ext.data.Model",fields:[{name:"Title",type:"string"},{name:"CreateTime",type:"string"},{name:"Content",type:"string"},{name:"Title2",type:"string"},{name:"Content2",type:"string"}]})},668:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(142),a=n.n(o),r=n(19),i=n.n(r),l=n(26),d=n.n(l),s=n(667),c=n(666),u=n(227),p=[c.a,s.a],f=function(){function e(){i()(this,e)}return d()(e,null,[{key:"getControl",value:function(e){return Ext.create("Ext.tab.Panel",{containerpanel:!0,renderTo:e,height:"100%",width:"100%",itemClick:function(e){var t=this,n=e.PROGID,o=e.MENUITEM;if(n===u.ConsoleItemKey.SUPPLATFORM){var r=Ext.util.Cookies.get("loginUserId"),i=Ext.util.Cookies.get("loginPassword");Ext.Ajax.request({url:"/sysSvc/vendorLogin",async:!1,method:"POST",jsonData:{userId:r,password:i},timeout:6e4,success:function(e){var t=Ext.decode(e.responseText),n=Ext.encode(t.VendorLoginResult);window.open("http://192.168.1.17:9996?params="+n),console.log(n)}})}else{var l=t.items.get(n);if(l)l.show();else{var l=null,d=!0,s=!1,c=void 0;try{for(var f,h=a()(p);!(d=(f=h.next()).done);d=!0){var g=f.value;g.id===n&&(l=g.getControl())}}catch(e){s=!0,c=e}finally{try{!d&&h.return&&h.return()}finally{if(s)throw c}}if(l){l.title=o,l.id=n,l.create();(function(){t.add(l).show()})()}}}}})}}]),e}()},669:function(e,t,n){"use strict";var o=n(19),a=n.n(o),r=n(26),i=n.n(r),l=function(){function e(){a()(this,e)}return i()(e,null,[{key:"toastrInit",value:function(){var e={closeButton:!0,debug:!1,positionClass:"toast-bottom-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};toastr.options=e}}]),e}();t.a=l}});
//# sourceMappingURL=1.137c9b486cd62932ea92.js.map